<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de Bord Planétaire</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        /* CSS maintenant externalisé dans styles.css */
    </style>
</head>
<body>
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            grid-template-rows: auto auto auto;
            gap: 20px;
            grid-template-areas: 
                "extinction extinction extinction"
                "global resources climate"
                "conflicts tech-risks health";
        }

        .section {
            background: rgba(15, 25, 45, 0.8);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: visible; /* Permet à la pop-up de sortir */
        }

        /* Override pour la ligne de scan qui a besoin d'overflow hidden */
        .section::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #00ffff, transparent);
            animation: scanLine 3s infinite;
            overflow: hidden; /* Contient seulement la ligne de scan */
        }



        @keyframes scanLine {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .section:hover {
            border-color: rgba(0, 255, 255, 0.6);
            box-shadow: 0 12px 40px rgba(0, 255, 255, 0.2);
        }

        .extinction-section {
            grid-area: extinction;
            text-align: center;
            padding: 30px;
        }

        .extinction-title {
            font-size: 2rem;
            font-weight: 900;
            color: #00ffff;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }

        .gauge-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            height: 120px;
        }

        .gauge-background {
            width: 100%;
            height: 60px;
            background: linear-gradient(to right, 
                #00ff00 0%, #00ff00 10%,
                #7fff00 10%, #7fff00 30%,
                #ffff00 30%, #ffff00 50%,
                #ff8c00 50%, #ff8c00 70%,
                #ff4500 70%, #ff4500 89%,
                #ff0000 89%, #ff0000 100%);
            border-radius: 30px;
            position: relative;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .gauge-ticks {
            position: absolute;
            top: -10px;
            width: 100%;
            height: 80px;
        }

        .tick {
            position: absolute;
            width: 2px;
            height: 15px;
            background: rgba(255, 255, 255, 0.7);
            top: 0;
        }

        .gauge-needle {
            position: absolute;
            top: -20px;
            left: 22%;
            width: 4px;
            height: 100px;
            background: linear-gradient(to bottom, #ffffff, #00ffff);
            border-radius: 2px;
            transform-origin: bottom center;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.8);
            animation: needleGlow 2s ease-in-out infinite alternate;
            transition: left 2s ease-out;
        }

        @keyframes needleGlow {
            0% { box-shadow: 0 0 15px rgba(0, 255, 255, 0.8); }
            100% { box-shadow: 0 0 25px rgba(0, 255, 255, 1); }
        }

        .world-commentary {
            margin-top: 25px;
            padding: 20px;
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid rgba(0, 255, 0, 0.3);
            border-radius: 12px;
            backdrop-filter: blur(5px);
        }

        .commentary-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #00ff00;
            margin: 0 0 15px 0;
            text-align: center;
            text-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
            font-family: 'Roboto', sans-serif;
        }

        .commentary-text {
            font-size: 0.95rem;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.9);
            text-align: justify;
        }

        .commentary-text p {
            margin: 0 0 12px 0;
        }

        .commentary-text p:last-child {
            margin-bottom: 0;
        }

        .world-commentary-hover {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .world-commentary-hover:hover {
            background: rgba(0, 255, 0, 0.2);
            border-color: rgba(0, 255, 0, 0.6);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 255, 0, 0.4);
        }

        .world-commentary-hover:hover .commentary-title {
            text-shadow: 0 0 15px rgba(0, 255, 0, 0.8);
        }

        .global-section {
            grid-area: global;
            overflow: visible; /* Permet à la pop-up de sortir du container */
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #00ffff;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .global-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .stat-item {
            background: rgba(0, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #00ffff;
            transition: all 0.3s ease;
            cursor: help;
        }

        .stat-item:hover {
            background: rgba(0, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 255, 255, 0.3);
        }

        .stat-item.updating {
            animation: data-update 1s ease-in-out;
        }

        @keyframes data-update {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; transform: scale(1.05); }
        }

        /* Population popup styling */
        .population-popup {
            position: fixed; /* Utilisation de fixed pour sortir complètement du flow */
            top: auto;
            left: auto;
            background: rgba(15, 25, 45, 0.95);
            border: 2px solid rgba(0, 255, 255, 0.6);
            border-radius: 12px;
            padding: 15px;
            min-width: 280px;
            backdrop-filter: blur(15px);
            box-shadow: 0 8px 32px rgba(0, 255, 255, 0.3);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 9999; /* Z-index très élevé pour être au-dessus de tout */
            font-family: 'Roboto', sans-serif;
            pointer-events: none; /* Évite les problèmes d'interaction */
        }

        .stat-item:hover .population-popup {
            pointer-events: auto; /* Réactive les interactions au hover */
        }

        .population-popup::before {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 8px solid rgba(0, 255, 255, 0.6);
            transition: all 0.3s ease;
        }

        .population-popup::after {
            content: '';
            position: absolute;
            bottom: -6px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid rgba(15, 25, 45, 0.95);
            transition: all 0.3s ease;
        }

        /* Variante quand la pop-up est en bas (flèche vers le haut) */
        .population-popup.bottom::before {
            bottom: auto;
            top: -8px;
            border-top: none;
            border-bottom: 8px solid rgba(0, 255, 255, 0.6);
        }

        .population-popup.bottom::after {
            bottom: auto;
            top: -6px;
            border-top: none;
            border-bottom: 6px solid rgba(15, 25, 45, 0.95);
        }

        .stat-item:hover .population-popup {
            opacity: 1;
            visibility: visible;
        }

        .popup-title {
            color: #00ffff;
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 10px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .popup-data {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .popup-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            border-bottom: 1px solid rgba(0, 255, 255, 0.2);
        }

        .popup-row:last-child {
            border-bottom: none;
        }

        .popup-label {
            color: #aaaaaa;
            font-size: 0.75rem;
        }

        .popup-value {
            color: #ffffff;
            font-weight: 700;
            font-size: 0.8rem;
        }

        .popup-link {
            margin-top: 10px;
            text-align: center;
        }

        .popup-link a {
            color: #00ffff;
            text-decoration: none;
            font-size: 0.7rem;
            padding: 5px 10px;
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 4px;
            transition: all 0.3s ease;
            display: inline-block;
        }

        .popup-link a:hover {
            background: rgba(0, 255, 255, 0.2);
            border-color: rgba(0, 255, 255, 0.6);
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
            animation: pulse-dot 2s ease-in-out infinite;
        }

        .status-live {
            background: #00ff00;
        }

        .status-cached {
            background: #ffaa00;
        }

        @keyframes pulse-dot {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Oil reserves map modal */
        .oil-map-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .oil-map-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .oil-map-container {
            background: rgba(15, 25, 45, 0.95);
            border: 2px solid rgba(255, 140, 0, 0.6);
            border-radius: 15px;
            padding: 20px;
            max-width: 90vw;
            max-height: 90vh;
            width: 1000px;
            height: 700px;
            position: relative;
            box-shadow: 0 20px 60px rgba(255, 140, 0, 0.3);
            animation: modal-appear 0.5s ease-out;
        }

        @keyframes modal-appear {
            from {
                transform: scale(0.8) translateY(50px);
                opacity: 0;
            }
            to {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        .oil-map-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 140, 0, 0.3);
        }

        .oil-map-title {
            color: #ff8c00;
            font-size: 1.2rem;
            font-weight: 700;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .oil-map-close {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid rgba(255, 0, 0, 0.5);
            color: #ff6464;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .oil-map-close:hover {
            background: rgba(255, 0, 0, 0.4);
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
        }

        .oil-map-iframe {
            width: 100%;
            height: 600px;
            border: 1px solid rgba(255, 140, 0, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
        }

        .oil-resource-hover {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .oil-resource-hover:hover {
            background: rgba(255, 140, 0, 0.2);
            border-color: rgba(255, 140, 0, 0.6);
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(255, 140, 0, 0.3);
        }

        .oil-resource-hover:hover .resource-label {
            color: #ff8c00;
            font-weight: 700;
        }

        .gas-resource-hover {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .gas-resource-hover:hover {
            background: rgba(65, 105, 225, 0.2);
            border-color: rgba(65, 105, 225, 0.6);
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(65, 105, 225, 0.3);
        }

        .gas-resource-hover:hover .resource-label {
            color: #4169e1;
            text-shadow: 0 0 8px rgba(65, 105, 225, 0.6);
        }

        /* Instructions pour l'utilisateur */
        .oil-map-instructions {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.8rem;
            text-align: center;
            font-family: 'Orbitron', monospace;
        }

        @media (max-width: 768px) {
            .oil-map-container {
                width: 95vw;
                height: 80vh;
                padding: 15px;
            }

            .oil-map-title {
                font-size: 1rem;
            }
        }

        /* Conflicts chart modal */
        .conflicts-chart-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .conflicts-chart-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .conflicts-chart-container {
            background: rgba(15, 25, 45, 0.95);
            border: 2px solid rgba(255, 0, 102, 0.6);
            border-radius: 15px;
            padding: 20px;
            max-width: 90vw;
            max-height: 90vh;
            width: 1000px;
            height: 700px;
            position: relative;
            box-shadow: 0 20px 60px rgba(255, 0, 102, 0.3);
            animation: modal-appear 0.5s ease-out;
        }

        .conflicts-chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 0, 102, 0.3);
        }

        .conflicts-chart-title {
            color: #ff0066;
            font-size: 1.2rem;
            font-weight: 700;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .conflicts-chart-close {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid rgba(255, 0, 0, 0.5);
            color: #ff6464;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .conflicts-chart-close:hover {
            background: rgba(255, 0, 0, 0.4);
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
        }

        .conflicts-chart-iframe {
            width: 100%;
            height: 600px;
            border: 1px solid rgba(255, 0, 102, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
        }

        /* Gas map modal */
        .gas-map-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .gas-map-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .gas-map-container {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f1419 100%);
            border: 2px solid rgba(65, 105, 225, 0.5);
            border-radius: 15px;
            padding: 20px;
            max-width: 95%;
            max-height: 95%;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.7);
            animation: modal-appear 0.5s ease-out;
        }

        .gas-map-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(65, 105, 225, 0.3);
        }

        .gas-map-title {
            color: #4169e1;
            font-size: 1.2rem;
            font-weight: 700;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .gas-map-close {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid rgba(255, 0, 0, 0.5);
            color: #ff6464;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .gas-map-close:hover {
            background: rgba(255, 0, 0, 0.4);
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
        }

        .gas-map-iframe {
            width: 100%;
            height: 600px;
            border: 1px solid rgba(65, 105, 225, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
        }

        /* Climate data modal */
        .climate-data-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .climate-data-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .climate-data-container {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f1419 100%);
            border: 2px solid rgba(0, 255, 127, 0.5);
            border-radius: 15px;
            padding: 20px;
            max-width: 95%;
            max-height: 95%;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.7);
            animation: modal-appear 0.5s ease-out;
        }

        .climate-data-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 255, 127, 0.3);
        }

        .climate-data-title {
            color: #00ff7f;
            font-size: 1.2rem;
            font-weight: 700;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .climate-data-close {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid rgba(255, 0, 0, 0.5);
            color: #ff6464;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .climate-data-close:hover {
            background: rgba(255, 0, 0, 0.4);
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
        }

        .climate-sections {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .climate-sections {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        .climate-counter-section {
            background: rgba(0, 255, 127, 0.1);
            border: 1px solid rgba(0, 255, 127, 0.3);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .climate-section-title {
            color: #00ff7f;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            font-family: 'Orbitron', monospace;
        }

        .climate-counter-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 120px;
        }

        .climate-data-instructions {
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Geopolitical analysis modal */
        .geopolitical-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .geopolitical-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .geopolitical-container {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f1419 100%);
            border: 2px solid rgba(0, 255, 0, 0.5);
            border-radius: 15px;
            padding: 25px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.8);
            animation: modal-appear 0.5s ease-out;
            scrollbar-width: thin;
            scrollbar-color: rgba(0, 255, 0, 0.5) rgba(0, 0, 0, 0.2);
        }

        .geopolitical-container::-webkit-scrollbar {
            width: 8px;
        }

        .geopolitical-container::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }

        .geopolitical-container::-webkit-scrollbar-thumb {
            background: rgba(0, 255, 0, 0.5);
            border-radius: 4px;
        }

        .geopolitical-container::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 255, 0, 0.7);
        }

        .geopolitical-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(0, 255, 0, 0.3);
        }

        .geopolitical-title {
            color: #00ff00;
            font-size: 1.3rem;
            font-weight: 700;
            font-family: 'Roboto', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
        }

        .geopolitical-close {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid rgba(255, 0, 0, 0.5);
            color: #ff6464;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .geopolitical-close:hover {
            background: rgba(255, 0, 0, 0.4);
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
        }

        .geopolitical-sections {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .geopolitical-sections {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .geopolitical-container {
                padding: 20px;
                max-width: 95%;
            }
        }

        .continent-card {
            background: rgba(0, 255, 0, 0.08);
            border: 1px solid rgba(0, 255, 0, 0.25);
            border-radius: 12px;
            padding: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .continent-card:hover {
            background: rgba(0, 255, 0, 0.15);
            border-color: rgba(0, 255, 0, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 0, 0.3);
        }

        .continent-card.expanded {
            background: rgba(0, 255, 0, 0.12);
            border-color: rgba(0, 255, 0, 0.4);
            padding-bottom: 20px;
            min-height: auto;
            align-items: flex-start;
        }

        .continent-card.expanded .expand-indicator {
            transform: rotate(180deg);
        }

        .continent-title {
            color: #00ff7f;
            font-size: 1.1rem;
            font-weight: 600;
            margin: 0;
            font-family: 'Roboto', sans-serif;
            text-shadow: 0 0 5px rgba(0, 255, 127, 0.5);
            flex-grow: 1;
        }

        .expand-indicator {
            color: #00ff7f;
            font-size: 1.2rem;
            font-weight: bold;
            transition: transform 0.3s ease;
            margin-left: 10px;
            user-select: none;
        }

        .continent-text {
            font-size: 0.9rem;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.9);
            text-align: justify;
            margin-top: 15px;
            width: 100%;
            transition: opacity 0.3s ease, max-height 0.3s ease;
            overflow: hidden;
        }

        .continent-text p {
            margin: 0 0 12px 0;
        }

        .continent-text p:last-child {
            margin-bottom: 0;
        }

        .geopolitical-instructions {
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .conflicts-section-hover {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .conflicts-section-hover:hover {
            background: rgba(255, 0, 102, 0.2);
            border-color: rgba(255, 0, 102, 0.6);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 0, 102, 0.3);
        }

        .conflicts-section-hover:hover .section-title {
            color: #ff0066;
            text-shadow: 0 0 10px rgba(255, 0, 102, 0.5);
        }

        /* Instructions pour l'utilisateur */
        .conflicts-chart-instructions {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.8rem;
            text-align: center;
            font-family: 'Orbitron', monospace;
        }

        @media (max-width: 768px) {
            .conflicts-chart-container {
                width: 95vw;
                height: 80vh;
                padding: 15px;
            }

            .conflicts-chart-title {
                font-size: 1rem;
            }
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #ffffff;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #aaaaaa;
            text-transform: uppercase;
        }

        .resources-section {
            grid-area: resources;
        }

        .resource-bar {
            margin: 15px 0;
        }

        .resource-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .resource-progress {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .resource-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 2s ease;
        }

        .oil-fill { background: linear-gradient(90deg, #ff8c00, #ffaa00); width: 45%; }
        .gas-fill { background: linear-gradient(90deg, #4169e1, #6495ed); width: 62%; }
        .water-fill { background: linear-gradient(90deg, #00bfff, #87ceeb); width: 78%; }

        .climate-section {
            grid-area: climate;
        }

        .climate-indicator {
            text-align: center;
            margin: 20px 0;
        }

        .temp-display {
            font-size: 2.5rem;
            font-weight: 900;
            color: #ff4500;
            text-shadow: 0 0 15px rgba(255, 69, 0, 0.5);
        }

        .climate-section-hover {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .climate-section-hover:hover {
            background: rgba(0, 255, 127, 0.15);
            border-color: rgba(0, 255, 127, 0.6);
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 255, 127, 0.3);
        }

        .climate-section-hover:hover .section-title {
            color: #00ff7f;
            text-shadow: 0 0 8px rgba(0, 255, 127, 0.6);
        }

        .conflicts-section {
            grid-area: conflicts;
            display: flex;
            justify-content: center;
        }

        .tech-risks-section {
            grid-area: tech-risks;
            display: flex;
            justify-content: center;
        }

        .conflict-subsection {
            background: rgba(255, 0, 100, 0.1);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 0, 100, 0.3);
            width: 100%;
            max-width: 300px;
        }

        .tech-risks-section .conflict-subsection {
            background: rgba(255, 165, 0, 0.1);
            border: 1px solid rgba(255, 165, 0, 0.3);
        }

        .conflict-counter {
            font-size: 2rem;
            font-weight: 900;
            color: #ff0066;
            text-align: center;
            margin: 10px 0;
        }

        .health-section {
            grid-area: health;
        }

        @media (max-width: 768px) {
            .dashboard-container {
                grid-template-columns: 1fr;
                grid-template-areas: 
                    "extinction"
                    "global"
                    "resources"
                    "climate"
                    "conflicts"
                    "tech-risks"
                    "health";
            }

            .conflicts-section {
                grid-template-columns: 1fr;
            }

            .extinction-title {
                font-size: 1.5rem;
            }

            .commentary-title {
                font-size: 1.2rem;
            }

            .commentary-text {
                font-size: 0.9rem;
            }

            .world-commentary {
                padding: 15px;
                margin-top: 20px;
            }
        }
        /* Audio controls styling for IEH section */
        .audio-controls-ieh {
            position: absolute;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(15, 25, 45, 0.9);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 6px;
            padding: 6px;
            backdrop-filter: blur(10px);
            width: 35px;
            height: 35px;
            transition: all 0.3s ease;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            cursor: pointer;
        }

        .audio-controls-ieh.expanded {
            width: 120px;
            padding: 8px;
        }

        .audio-controls-ieh button {
            background: rgba(0, 255, 255, 0.2);
            border: 1px solid rgba(0, 255, 255, 0.5);
            color: #00ffff;
            padding: 4px 6px;
            border-radius: 3px;
            cursor: pointer;
            font-family: 'Orbitron', monospace;
            font-size: 0.7rem;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-width: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 25px;
        }

        .audio-controls-ieh button:hover {
            background: rgba(0, 255, 255, 0.4);
            box-shadow: 0 0 8px rgba(0, 255, 255, 0.3);
        }

        .audio-controls-ieh button:active {
            transform: scale(0.95);
        }

        .audio-controls-ieh .audio-icon {
            font-size: 1rem;
        }

        .audio-controls-ieh .audio-text {
            margin-left: 6px;
            opacity: 0;
            transition: opacity 0.3s ease;
            font-size: 0.6rem;
        }

        .audio-controls-ieh.expanded .audio-text {
            opacity: 1;
        }

        /* Credits styling */
        .credits {
            position: fixed;
            bottom: 10px;
            left: 10px;
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.6);
            background: rgba(0, 0, 0, 0.7);
            padding: 8px;
            border-radius: 4px;
            max-width: 400px;
            z-index: 1000;
        }

        .credits a {
            color: #00ffff;
            text-decoration: none;
        }

        .credits a:hover {
            text-decoration: underline;
        }

        /* News header styling */
        .news-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 35px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            z-index: 2001;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
        }

        /* News ticker styling */
        .news-ticker {
            position: fixed;
            top: 35px;
            left: 0;
            width: 100%;
            height: 40px;
            background: linear-gradient(90deg, #ff0000, #ff4500, #ff0000);
            color: white;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            overflow: hidden;
            z-index: 2000;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 20px rgba(255, 0, 0, 0.3);
        }

        .breaking-news {
            color: #ffffff;
            font-weight: 700;
        }

        .live-status {
            font-size: 0.8rem;
            font-weight: 400;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .news-ticker {
            position: relative;
        }

        #newsStatus {
            animation: pulse-status 2s ease-in-out infinite alternate;
        }

        @keyframes pulse-status {
            0% { opacity: 0.6; }
            100% { opacity: 1; }
        }

        .news-content {
            white-space: nowrap;
            animation: scroll-left 150s linear infinite;
            padding-left: 20px;
            display: flex;
            align-items: center;
            width: 100%;
            height: 100%;
            mask: linear-gradient(to right, transparent 0%, black 100px, black calc(100% - 100px), transparent 100%);
            -webkit-mask: linear-gradient(to right, transparent 0%, black 100px, black calc(100% - 100px), transparent 100%);
        }

        @keyframes scroll-left {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        .news-item {
            margin-right: 80px;
            display: inline-block;
        }

        .news-item::before {
            content: '●';
            color: #00ffff;
            margin-right: 10px;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
        }

        @media (max-width: 768px) {
            body {
                padding-top: 65px;
            }

            .audio-controls-ieh {
                bottom: 15px;
                right: 15px;
                padding: 4px;
                width: 30px;
                height: 30px;
            }

            .audio-controls-ieh.expanded {
                width: 100px;
                padding: 6px;
            }

            .audio-controls-ieh button {
                height: 20px;
                min-width: 20px;
                font-size: 0.6rem;
            }

            .audio-controls-ieh .audio-icon {
                font-size: 0.8rem;
            }

            .credits {
                font-size: 0.6rem;
                max-width: 300px;
            }

            .news-header {
                height: 30px;
                font-size: 0.75rem;
                padding: 0 10px;
            }

            .news-ticker {
                top: 30px;
                height: 35px;
                font-size: 0.8rem;
            }

            .breaking-news {
                font-size: 0.7rem;
            }

            .live-status {
                font-size: 0.6rem;
            }

            .news-content {
                animation-duration: 115s; /* Proportionnellement plus lent */
            }
        }
    </style>
</head>
<body>
    <!-- Audio Background -->
    <audio id="backgroundAudio" loop preload="auto">
        <source src="sounds/212025__qubodup__sci-fi-laboratory-ambience.ogg" type="audio/ogg">
        <source src="sounds/212025__qubodup__sci-fi-laboratory-ambience.mp3" type="audio/mpeg">
    </audio>

    <!-- Credits -->
    <div class="credits">
        Audio: <a href="http://freesound.org/people/qubodup/sounds/212025">Sci-fi Laboratory Ambience</a> by <a href="http://freesound.org/people/qubodup">Iwan Gabovitch</a> under <a href="http://creativecommons.org/licenses/by/3.0/legalcode">CC-BY 3.0 License</a> with sounds by wolick, swiftoid, Diboz
    </div>

    <!-- News Header -->
    <div class="news-header">
        <span class="breaking-news">🚨 INFOS EN DIRECT</span>
        <span class="live-status" id="liveStatus">
            <span class="status-indicator status-cached"></span>
            <span>FRANCE 24 LIVE</span>
        </span>
    </div>

    <!-- News Ticker -->
    <div class="news-ticker">
        <div class="news-content" id="newsContent">
            <span class="news-item">🔄 Chargement des dernières nouvelles France24...</span>
        </div>
    </div>

    <!-- Oil Map Modal -->
    <div class="oil-map-modal" id="oilMapModal">
        <div class="oil-map-container">
            <div class="oil-map-header">
                <div class="oil-map-title">🛢️ Réserves Mondiales de Pétrole</div>
                <button class="oil-map-close" onclick="closeOilMap()">×</button>
            </div>
            <iframe src="https://ourworldindata.org/grapher/oil-proved-reserves?tab=map" 
                    loading="lazy" 
                    style="width: 100%; height: 600px; border: 0px none;" 
                    allow="web-share; clipboard-write"
                    class="oil-map-iframe">
            </iframe>
            <div class="oil-map-instructions">
                Cliquez sur × pour fermer • Données: Our World in Data
            </div>
        </div>
    </div>

    <!-- Conflicts Chart Modal -->
    <div class="conflicts-chart-modal" id="conflictsChartModal">
        <div class="conflicts-chart-container">
            <div class="conflicts-chart-header">
                <div class="conflicts-chart-title">⚔️ Conflits Armés dans le Monde</div>
                <button class="conflicts-chart-close" onclick="closeConflictsChart()">×</button>
            </div>
            <iframe src="https://ourworldindata.org/grapher/number-of-armed-conflicts?tab=chart" 
                    loading="lazy" 
                    style="width: 100%; height: 600px; border: 0px none;" 
                    allow="web-share; clipboard-write"
                    class="conflicts-chart-iframe">
            </iframe>
            <div class="conflicts-chart-instructions">
                Cliquez sur × pour fermer • Données: Our World in Data
            </div>
        </div>
    </div>

    <!-- Gas Map Modal -->
    <div class="gas-map-modal" id="gasMapModal">
        <div class="gas-map-container">
            <div class="gas-map-header">
                <div class="gas-map-title">🔥 Réserves de Gaz Naturel</div>
                <button class="gas-map-close" onclick="closeGasMap()">×</button>
            </div>
            <iframe src="https://ourworldindata.org/grapher/natural-gas-proved-reserves?tab=map" 
                    loading="lazy" 
                    style="width: 100%; height: 600px; border: 0px none;" 
                    allow="web-share; clipboard-write"
                    class="gas-map-iframe">
            </iframe>
            <div class="gas-map-instructions">
                Cliquez sur × pour fermer • Données: Our World in Data
            </div>
        </div>
    </div>

    <!-- Climate Data Modal -->
    <div class="climate-data-modal" id="climateDataModal">
        <div class="climate-data-container">
            <div class="climate-data-header">
                <div class="climate-data-title">🌡️ Données Climatiques Mondiales</div>
                <button class="climate-data-close" onclick="closeClimateData()">×</button>
            </div>
            
            <div class="climate-sections">
                <div class="climate-counter-section">
                    <h3 class="climate-section-title">🌡️ Température Globale Moyenne</h3>
                    <div class="climate-counter-container">
                        <iframe title='World average temperature (°C)' 
                                src='https://www.theworldcounts.com/embeds/counters/21?background_color=white&color=black&font_family=%22Helvetica+Neue%22%2C+Arial%2C+sans-serif&font_size=14' 
                                style='border: none' 
                                height='100' 
                                width='300'>
                        </iframe>
                    </div>
                </div>
                
                <div class="climate-counter-section">
                    <h3 class="climate-section-title">🌊 Montée du Niveau des Océans</h3>
                    <div class="climate-counter-container">
                        <iframe title='Rise in sea levels (cm)' 
                                src='https://www.theworldcounts.com/embeds/counters/68?background_color=white&color=black&font_family=%22Helvetica+Neue%22%2C+Arial%2C+sans-serif&font_size=14' 
                                style='border: none' 
                                height='100' 
                                width='300'>
                        </iframe>
                    </div>
                </div>
            </div>
            
            <div class="climate-data-instructions">
                Cliquez sur × pour fermer • Données: The World Counts
            </div>
        </div>
    </div>

    <!-- Geopolitical Analysis Modal -->
    <div class="geopolitical-modal" id="geopoliticalModal">
        <div class="geopolitical-container">
            <div class="geopolitical-header">
                <div class="geopolitical-title">🌍 Analyse Géopolitique Mondiale - Octobre 2025</div>
                <button class="geopolitical-close" onclick="closeGeopoliticalAnalysis()">×</button>
            </div>
            
            <div class="geopolitical-sections">
                <div class="continent-card" onclick="toggleContinentSection('africa')" title="Cliquez pour développer">
                    <h3 class="continent-title">🌍 Situation en Afrique</h3>
                    <div class="expand-indicator">▼</div>
                    <div class="continent-text" id="africa-text" style="display: none;">
                        <p>En octobre 2025, l'Afrique fait face à une situation géopolitique marquée par une croissance économique résiliente, projetée à 3,9 % pour l'année, malgré des vents contraires mondiaux comme les tensions commerciales et les conflits armés. Des crises persistantes, telles que la guerre civile au Soudan et les instabilités post-électorales au Mozambique et en Mauritanie, alimentent des frustrations sociales et des risques sécuritaires, exacerbés par l'ingérence extérieure des Émirats arabes unis et de la Russie.</p>
                        <p>L'Union africaine renforce ses partenariats avec l'ONU pour la paix et la sécurité, tandis que des élections à venir au Cameroun, en Côte d'Ivoire et en Tanzanie pourraient éroder davantage la démocratie. Au milieu de ces défis, l'Afrique de l'Est mène la croissance à 5,9 %, mais la pauvreté, le changement climatique et la gouvernance faible menacent une stabilité durable, avec des appels croissants à une intégrité électorale accrue pour soutenir le développement.</p>
                    </div>
                </div>

                <div class="continent-card" onclick="toggleContinentSection('asia')" title="Cliquez pour développer">
                    <h3 class="continent-title">🏯 Situation en Asie</h3>
                    <div class="expand-indicator">▼</div>
                    <div class="continent-text" id="asia-text" style="display: none;">
                        <p>L'Asie en octobre 2025 est au cœur d'une rivalité géopolitique intense entre les États-Unis et la Chine, amplifiée par le retour de Donald Trump à la Maison Blanche, qui promet une escalade des guerres commerciales et des tensions sur les minéraux critiques. Des points chauds comme la mer de Chine méridionale, Taïwan et la péninsule coréenne risquent des confrontations non militaires accrues, tandis que la Corée du Nord consolide son pacte de défense mutuelle avec la Russie, déployant des troupes en Ukraine.</p>
                        <p>Le Sud-Est asiatique navigue entre ces dynamiques, avec des initiatives comme l'adhésion potentielle de la Chine au CPTPP et des élections en Australie et à Singapour testant la stabilité régionale. Malgré une reprise fragile de la consommation, les politiques protectionnistes américaines et la concurrence en IA redessinent les chaînes d'approvisionnement, positionnant l'Asie comme le moteur de croissance mondial mais vulnérable à une fragmentation accrue.</p>
                    </div>
                </div>

                <div class="continent-card" onclick="toggleContinentSection('europe')" title="Cliquez pour développer">
                    <h3 class="continent-title">🏰 Situation en Europe</h3>
                    <div class="expand-indicator">▼</div>
                    <div class="continent-text" id="europe-text" style="display: none;">
                        <p>En octobre 2025, l'Europe est confrontée à une "récession géopolitique" où le conflit en Ukraine persiste, forçant une diversification énergétique et une augmentation des dépenses de défense face à une Russie affaiblie mais agressive. Les tensions commerciales avec les États-Unis sous Trump, incluant des menaces de tarifs douaniers, et avec la Chine sur les véhicules électriques, accentuent les divisions internes au sein de l'UE, limitée par des contraintes budgétaires comme la "brake" allemande sur la dette.</p>
                        <p>La Commission européenne, sous Ursula von der Leyen, pousse pour une "Commission géopolitique" renforçant la souveraineté économique et la statecraft défensive, tandis que des élections au Canada et en Irlande ajoutent de l'incertitude. Malgré une croissance faible, l'Europe cherche à équilibrer ses alliances atlantiques et à contrer l'influence russe et chinoise, avec une focalisation sur la cybersécurité et l'IA pour préserver sa compétitivité globale.</p>
                    </div>
                </div>

                <div class="continent-card" onclick="toggleContinentSection('northAmerica')" title="Cliquez pour développer">
                    <h3 class="continent-title">🗽 Situation en Amérique du Nord</h3>
                    <div class="expand-indicator">▼</div>
                    <div class="continent-text" id="northAmerica-text" style="display: none;">
                        <p>L'Amérique du Nord en octobre 2025 est dominée par l'agenda imprévisible de la seconde administration Trump, qui priorise un isolationnisme transactionnel avec des pressions sur les alliés pour plus de dépenses de défense et des négociations de cessez-le-feu en Ukraine, tout en imposant des tarifs massifs sur la Chine et potentiellement l'Europe. Les États-Unis consolident leur leadership en IA et biotechnologies, mais font face à des risques cybernétiques accrus et à une concurrence géoéconomique fragmentant les chaînes d'approvisionnement.</p>
                        <p>Au Canada, des élections fédérales en octobre pourraient redéfinir les relations avec Washington, tandis que le Mexique gère les flux migratoires et commerciaux sous pression. Malgré une croissance modérée, la région navigue des tensions internes sur l'énergie et le climat, positionnant l'Amérique du Nord comme pivot central d'une reconfiguration globale des alliances et du commerce.</p>
                    </div>
                </div>

                <div class="continent-card" onclick="toggleContinentSection('southAmerica')" title="Cliquez pour développer">
                    <h3 class="continent-title">🌎 Situation en Amérique du Sud</h3>
                    <div class="expand-indicator">▼</div>
                    <div class="continent-text" id="southAmerica-text" style="display: none;">
                        <p>En octobre 2025, l'Amérique du Sud connaît une croissance modérée d'environ 2,5 %, boostée par des opportunités dans les minéraux pour la transition énergétique, mais menacée par les incendies amazoniens records et la rareté hydrique due au changement climatique. Les tensions géopolitiques s'intensifient avec le retour de Trump, amplifiant les risques migratoires et commerciaux, tandis que les cartels de drogue, enrichis par une production de cocaïne doublée, étendent leur influence vers l'Asie et l'Afrique, alimentant l'instabilité au Pérou et en Colombie.</p>
                        <p>Des élections au Chili pourraient favoriser les conservateurs, et des leaders comme Nayib Bukele au Salvador inspirent des politiques sécuritaires musclées. Le sommet climatique de l'ONU à Belém, au Brésil, offre une chance de coordination régionale, mais des divisions entre gouvernements de gauche et de droite, couplées à la concurrence sino-américaine pour les ressources, soulignent la vulnérabilité d'une région aux catastrophes environnementales et aux flux illicites.</p>
                    </div>
                </div>

                <div class="continent-card" onclick="toggleContinentSection('oceania')" title="Cliquez pour développer">
                    <h3 class="continent-title">🏝️ Situation en Océanie</h3>
                    <div class="expand-indicator">▼</div>
                    <div class="continent-text" id="oceania-text" style="display: none;">
                        <p>L'Océanie en octobre 2025 émerge comme un théâtre prioritaire de la compétition entre grandes puissances, avec les États-Unis intensifiant leur engagement via la Stratégie Indo-Pacifique pour contrer l'influence chinoise grandissante dans les îles du Pacifique, où Pékin est le troisième donateur d'aide après l'Australie et la Nouvelle-Zélande. Des élections fédérales précoces en Australie et le premier test électoral du Premier ministre singapourien Lawrence Wong testent la résilience régionale face aux tensions en mer de Chine méridionale et aux pactes comme celui entre la Corée du Nord et la Russie.</p>
                        <p>Le changement climatique, menaçant les États insulaires par la montée des eaux, amplifie les appels à une coopération multilatérale, tandis que la Malaisie préside l'ASEAN et les Îles Salomon le Forum des îles du Pacifique. Malgré une croissance stable, la région gère des défis en cybersécurité et ressources, équilibrant souveraineté et partenariats pour préserver sa stabilité stratégique.</p>
                    </div>
                </div>

                <div class="continent-card" onclick="toggleContinentSection('antarctica')" title="Cliquez pour développer">
                    <h3 class="continent-title">🧊 Situation en Antarctique</h3>
                    <div class="expand-indicator">▼</div>
                    <div class="continent-text" id="antarctica-text" style="display: none;">
                        <p>En octobre 2025, l'Antarctique reste un bastion de coopération scientifique sous le Traité antarctique, mais fait face à des pressions géopolitiques croissantes avec l'essor de la présence chinoise et russe, qui testent les limites de la démilitarisation et de l'interdiction minière via des recherches sur les ressources fossiles et minérales. Des niveaux historiquement bas de glace de mer pour la quatrième année consécutive, dus au réchauffement climatique, accélèrent la fonte des glaciers et menacent la montée des eaux globales, tandis qu'un événement de réchauffement stratosphérique soudain en septembre a fait grimper les températures de plus de 30 °C.</p>
                        <p>Des expéditions comme celle de l'Australian RSV Nuyina et des études sur les carottes de glace par la British Antarctic Survey soulignent l'urgence scientifique, mais des incidents comme l'évaluation psychologique d'un chercheur sud-africain rappellent les fragilités humaines. Bien que sans conflits armés, la région risque une érosion du statu quo face à des revendications territoriales latentes et à l'intérêt commercial croissant.</p>
                    </div>
                </div>
            </div>
            
            <div class="geopolitical-instructions">
                Cliquez sur × pour fermer • Analyse géopolitique - Octobre 2025
            </div>
        </div>
    </div>

    <div class="dashboard-container">
        <div class="section extinction-section">
            <h1 class="extinction-title">INDICE D'EXTINCTION DE L'HUMANITÉ</h1>
            <div class="gauge-container">
                <div class="gauge-background">
                    <div class="gauge-ticks" id="gaugeTicks"></div>
                    <div class="gauge-needle" id="gaugeNeedle"></div>
                </div>
            </div>
            <div class="world-commentary world-commentary-hover" onclick="showGeopoliticalAnalysis()" title="Cliquez pour voir l'analyse géopolitique détaillée par continent">
                <h3 class="commentary-title">État global : Stabilité sous tension</h3>
                <div class="commentary-text">
                    <p>L'humanité évolue dans une phase de stabilité fragile. La population mondiale dépasse les huit milliards d'habitants, soutenue par une économie encore fonctionnelle et des ressources énergétiques disponibles, bien que sous pression.</p>
                    
                    <p>Les conflits internationaux restent limités : seules quelques guerres inter-étatiques persistent, tandis que la majorité des tensions se concentrent à l'intérieur des frontières. Les grandes puissances maintiennent un fragile équilibre diplomatique, évitant pour l'instant une escalade mondiale.</p>
                    
                    <p>Les indicateurs environnementaux demeurent préoccupants, mais les efforts de transition énergétique et les avancées technologiques ralentissent partiellement la dégradation.</p>
                    
                    <p>La jauge reste donc dans le vert, signalant que malgré les fractures et les risques émergents, l'humanité conserve encore une marge de sécurité avant le basculement.</p>
                </div>
            </div>
            
            <!-- Audio Controls -->
            <div class="audio-controls-ieh" id="audioControlsIEH" onclick="toggleAudioPanel()">
                <button id="audioToggle" onclick="toggleAudio(event)">
                    <span class="audio-icon">🔇</span>
                    <span class="audio-text">AUDIO OFF</span>
                </button>
            </div>
        </div>

        <div class="section global-section">
            <h2 class="section-title">🌍 Statut Global</h2>
            <div class="global-stats">
                <div class="stat-item population-item" title="Population mondiale (Banque Mondiale)">
                    <div class="stat-value" id="populationValue">8.1B</div>
                    <div class="stat-label">Population 🌍</div>
                    <div class="population-popup" id="populationPopup">
                        <div class="popup-title">🌍 Population Mondiale</div>
                        <div class="popup-data">
                            <div class="popup-row">
                                <span class="popup-label">Population exacte:</span>
                                <span class="popup-value" id="exactPopulation">Chargement...</span>
                            </div>
                            <div class="popup-row">
                                <span class="popup-label">Année de référence:</span>
                                <span class="popup-value" id="populationYear">-</span>
                            </div>
                            <div class="popup-row">
                                <span class="popup-label">Source:</span>
                                <span class="popup-value">Banque Mondiale</span>
                            </div>
                            <div class="popup-row">
                                <span class="popup-label">Statut:</span>
                                <span class="popup-value">
                                    <span class="status-indicator status-cached" id="statusIndicator"></span>
                                    <span id="statusText">Données par défaut</span>
                                </span>
                            </div>
                        </div>
                        <div class="popup-link">
                            <a href="https://data.worldbank.org/indicator/SP.POP.TOTL" target="_blank" rel="noopener">
                                🔗 Voir sur worldbank.org
                            </a>
                        </div>
                    </div>
                </div>
                <div class="stat-item" title="Conflits armés internationaux actifs">
                    <div class="stat-value">12</div>
                    <div class="stat-label">Guerres Actives</div>
                </div>
                <div class="stat-item" title="Ressources en situation critique">
                    <div class="stat-value">847</div>
                    <div class="stat-label">Ressources Critiques</div>
                </div>
                <div class="stat-item" title="Pourcentage de régions stables">
                    <div class="stat-value">73%</div>
                    <div class="stat-label">Stabilité Régionale</div>
                </div>
            </div>
        </div>

        <div class="section resources-section">
            <h2 class="section-title">⚡ Ressources & Énergie</h2>
            <div class="resource-bar oil-resource-hover" onclick="showOilMap()" title="Cliquez pour voir la carte des réserves mondiales">
                <div class="resource-label">
                    <span>🛢️ Pétrole</span>
                    <span>45%</span>
                </div>
                <div class="resource-progress">
                    <div class="resource-fill oil-fill"></div>
                </div>
            </div>
            <div class="resource-bar gas-resource-hover" onclick="showGasMap()" title="Cliquez pour voir la carte des réserves mondiales de gaz naturel">
                <div class="resource-label">
                    <span>🔥 Gaz Naturel</span>
                    <span>62%</span>
                </div>
                <div class="resource-progress">
                    <div class="resource-fill gas-fill"></div>
                </div>
            </div>
            <div class="resource-bar">
                <div class="resource-label">
                    <span>💧 Eau Douce</span>
                    <span>78%</span>
                </div>
                <div class="resource-progress">
                    <div class="resource-fill water-fill"></div>
                </div>
            </div>
        </div>

        <div class="section climate-section climate-section-hover" onclick="showClimateData()" title="Cliquez pour voir les données climatiques en temps réel">
            <h2 class="section-title">🌡️ Climat & Biodiversité</h2>
            <div class="climate-indicator">
                <div class="stat-label">Anomalie Température</div>
                <div class="temp-display">+1.8°C</div>
            </div>
        </div>

        <div class="section conflicts-section conflicts-section-hover" onclick="showConflictsChart()" title="Cliquez pour voir l'évolution des conflits armés" onmouseenter="playWarSound()" onmouseleave="stopWarSound()">
            <div class="conflict-subsection">
                <h3 class="section-title">⚔️ Conflits</h3>
                <div class="conflict-counter">12</div>
                <div class="stat-label">Guerres Actives</div>
                <div class="conflict-counter">47</div>
                <div class="stat-label">Tensions Internes</div>
            </div>
        </div>

        <div class="section tech-risks-section">
            <div class="conflict-subsection">
                <h3 class="section-title">☢️ Risques Tech</h3>
            </div>
        </div>

        <div class="section health-section">
            <h2 class="section-title">🧬 Santé & Stabilité</h2>
            <div class="stat-item">
                <div class="stat-value">2</div>
                <div class="stat-label">Pandémies Actives</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">84%</div>
                <div class="stat-label">Résilience Infrastructure</div>
            </div>
        </div>
    </div>

    <script>
        let audioEnabled = false;
        const audio = document.getElementById('backgroundAudio');
        const audioToggle = document.getElementById('audioToggle');

        // Initialize audio
        audio.volume = 0.3; // Volume à 30% pour ne pas être trop fort

        // Effets sonores pour les modales
        const expansionOpenSound = new Audio('sounds/expansion1.wav');
        const expansionCloseSound = new Audio('sounds/expansion2.wav');
        const warSound = new Audio('sounds/war.wav');
        
        // Configuration des effets sonores
        expansionOpenSound.volume = 0.4;
        expansionCloseSound.volume = 0.4;
        warSound.volume = 0.3;

        function toggleAudioPanel() {
            const audioControls = document.getElementById('audioControlsIEH');
            if (audioControls) {
                audioControls.classList.toggle('expanded');
            }
        }

        function toggleAudio(event) {
            event.stopPropagation(); // Empêche la propagation vers toggleAudioPanel
            
            const audioToggle = document.getElementById('audioToggle');
            const audioIcon = audioToggle.querySelector('.audio-icon');
            const audioText = audioToggle.querySelector('.audio-text');
            
            if (audioEnabled) {
                audio.pause();
                audioIcon.textContent = '🔇';
                audioText.textContent = 'AUDIO OFF';
                audioToggle.style.background = 'rgba(255, 100, 100, 0.2)';
                audioToggle.style.borderColor = 'rgba(255, 100, 100, 0.5)';
                audioToggle.style.color = '#ff6464';
                audioEnabled = false;
            } else {
                audio.play().catch(e => {
                    console.log('Erreur lecture audio:', e);
                    alert('Impossible de lire l\'audio. Votre navigateur bloque peut-être la lecture automatique.');
                });
                audioIcon.textContent = '🔊';
                audioText.textContent = 'AUDIO ON';
                audioToggle.style.background = 'rgba(0, 255, 255, 0.2)';
                audioToggle.style.borderColor = 'rgba(0, 255, 255, 0.5)';
                audioToggle.style.color = '#00ffff';
                audioEnabled = true;
            }
        }

        // Auto-start audio après interaction utilisateur (requis par les navigateurs modernes)
        document.addEventListener('click', function startAudio() {
            if (!audioEnabled) {
                toggleAudio();
            }
            document.removeEventListener('click', startAudio);
        }, { once: true });

        // Fonction pour jouer le son de guerre au survol de la section conflits
        function playWarSound() {
            warSound.currentTime = 0;
            warSound.play().catch(e => console.log('Erreur son guerre:', e));
        }

        // Fonction pour arrêter le son de guerre
        function stopWarSound() {
            warSound.pause();
            warSound.currentTime = 0;
        }

        // Gestion des erreurs audio
        audio.addEventListener('error', function(e) {
            console.log('Erreur audio:', e);
            audioToggle.innerHTML = '❌ AUDIO ERROR';
            audioToggle.disabled = true;
        });

        // News ticker functionality with France24 RSS feed
        const fallbackNews = [
            "Tensions nucléaires en hausse : 3 pays placent leurs forces en alerte maximale",
            "Réchauffement climatique : nouveau record de +2.1°C atteint ce mois",
            "Crise énergétique mondiale : les réserves de pétrole chutent à 42%",
            "Pandémie H7N3 : 12 nouveaux foyers détectés en Asie du Sud-Est",
            "IA militaire : première utilisation autonome signalée dans un conflit",
            "Effondrement de la biodiversité : 15 espèces déclarées éteintes cette semaine"
        ];

        let currentNewsItems = [...fallbackNews];

        async function fetchFrance24News() {
            try {
                console.log('🔄 Récupération des nouvelles France24...');
                const response = await fetch('https://api.rss2json.com/v1/api.json?rss_url=https://www.france24.com/fr/rss');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('📰 Données reçues:', data);
                
                if (data.status === 'ok' && data.items && data.items.length > 0) {
                    // Extraire les titres et nettoyer le HTML
                    currentNewsItems = data.items.slice(0, 10).map(item => {
                        // Nettoyer le titre des balises HTML
                        const cleanTitle = item.title.replace(/<[^>]*>/g, '').trim();
                        return cleanTitle;
                    });
                    
                    console.log('✅ Nouvelles France24 chargées:', currentNewsItems.length);
                    updateNewsTicker();
                    
                    // Mettre à jour l'indicateur de statut
                    updateNewsStatus('LIVE FRANCE24', '#00ff00');
                } else {
                    throw new Error('Format de données invalide');
                }
            } catch (error) {
                console.warn('⚠️ Erreur lors du chargement des nouvelles France24:', error);
                console.log('🔄 Utilisation des nouvelles de secours...');
                currentNewsItems = [...fallbackNews];
                updateNewsTicker();
                updateNewsStatus('NOUVELLES LOCALES', '#ffaa00');
            }
        }

        function updateNewsTicker() {
            const newsContent = document.getElementById('newsContent');
            const shuffledNews = [...currentNewsItems].sort(() => Math.random() - 0.5);
            
            newsContent.innerHTML = shuffledNews.map(item => 
                `<span class="news-item">${item}</span>`
            ).join('');
        }

        function updateNewsStatus(status, color) {
            const liveStatus = document.getElementById('liveStatus');
            if (liveStatus) {
                const indicator = liveStatus.querySelector('.status-indicator');
                const text = liveStatus.querySelector('span:last-child');
                
                if (indicator && text) {
                    indicator.className = `status-indicator ${color === '#00ff00' ? 'status-live' : 'status-cached'}`;
                    text.textContent = status;
                }
            }
        }

        // Système de calcul IEH (Indice d'Extinction de l'Humanité)
        const iehConfig = {
            guerresEntrePays: { value: 3, max: 10, weight: 10 },
            conflitsInternes: { value: 12, max: 50, weight: 8 },
            petroleDisponible: { value: 45, max: 100, weight: 6, inverse: true }, // 45% = pénurie
            gazDisponible: { value: 62, max: 100, weight: 5, inverse: true },
            eauDisponible: { value: 78, max: 100, weight: 12, inverse: true },
            temperatureAnomalie: { value: 1.8, max: 5, weight: 18 },
            biodiversitePerdue: { value: 60, max: 100, weight: 12 },
            tensionNucleaire: { value: 6, max: 10, weight: 15 },
            pandemiesActives: { value: 2, max: 10, weight: 6 },
            risqueIA: { value: 4, max: 10, weight: 8 }
        };

        function calculateIEH() {
            let totalContribution = 0;
            let totalWeight = 0;
            
            console.log('🧮 Calcul IEH en cours...');
            
            for (const [key, config] of Object.entries(iehConfig)) {
                let normalizedValue;
                
                if (config.inverse) {
                    // Pour les ressources : plus c'est bas, plus c'est dangereux
                    normalizedValue = 1 - (config.value / 100);
                } else {
                    // Pour les menaces : plus c'est haut, plus c'est dangereux
                    normalizedValue = config.value / config.max;
                }
                
                const contribution = config.weight * normalizedValue;
                totalContribution += contribution;
                totalWeight += config.weight;
                
                console.log(`📊 ${key}: ${config.value} → normalized: ${normalizedValue.toFixed(3)} → contrib: ${contribution.toFixed(2)}`);
            }
            
            // Score normalisé sur la somme des poids max (100)
            const normalizedScore = totalContribution / 100;
            
            // Conversion en IEH (1 à 99)
            const ieh = Math.max(1, Math.min(99, 1 + Math.round(normalizedScore * 98)));
            
            console.log(`🎯 Score total: ${totalContribution.toFixed(2)}/100`);
            console.log(`📈 Score normalisé: ${normalizedScore.toFixed(4)}`);
            console.log(`⚠️ IEH calculé: ${ieh}/99`);
            
            return {
                ieh: ieh,
                score: normalizedScore,
                totalContribution: totalContribution,
                details: Object.entries(iehConfig).map(([key, config]) => ({
                    name: key,
                    value: config.value,
                    contribution: config.weight * (config.inverse ? 1 - (config.value / 100) : config.value / config.max)
                }))
            };
        }

        function updateIEHDisplay() {
            const result = calculateIEH();
            const gaugeValue = document.getElementById('gaugeValue');
            const gaugeNeedle = document.getElementById('gaugeNeedle');
            
            // Mettre à jour l'affichage
            gaugeValue.textContent = `${result.ieh} / 99`;
            
            // Positionner l'aiguille (position en pourcentage)
            const needlePosition = (result.ieh / 99) * 100;
            gaugeNeedle.style.left = `${needlePosition}%`;
            
            // Changer la couleur selon le niveau de danger
            let color, textShadow;
            if (result.ieh <= 20) {
                color = '#00ff00'; // Vert - situation stable
                textShadow = '0 0 20px rgba(0, 255, 0, 0.5)';
            } else if (result.ieh <= 40) {
                color = '#7fff00'; // Vert-jaune - préoccupant
                textShadow = '0 0 20px rgba(127, 255, 0, 0.5)';
            } else if (result.ieh <= 60) {
                color = '#ffff00'; // Jaune - dangereux
                textShadow = '0 0 20px rgba(255, 255, 0, 0.5)';
            } else if (result.ieh <= 80) {
                color = '#ff8c00'; // Orange - très dangereux
                textShadow = '0 0 20px rgba(255, 140, 0, 0.5)';
            } else {
                color = '#ff0000'; // Rouge - critique
                textShadow = '0 0 20px rgba(255, 0, 0, 0.8)';
            }
            
            gaugeValue.style.color = color;
            gaugeValue.style.textShadow = textShadow;
            
            return result;
        }

        function updateMetrics() {
            // Simuler de légères variations dans les métriques
            const variations = {
                guerresEntrePays: () => Math.max(0, Math.min(10, iehConfig.guerresEntrePays.value + (Math.random() - 0.5) * 0.2)),
                conflitsInternes: () => Math.max(0, Math.min(50, iehConfig.conflitsInternes.value + (Math.random() - 0.5) * 2)),
                temperatureAnomalie: () => Math.max(0, Math.min(5, iehConfig.temperatureAnomalie.value + (Math.random() - 0.5) * 0.1)),
                tensionNucleaire: () => Math.max(0, Math.min(10, iehConfig.tensionNucleaire.value + (Math.random() - 0.5) * 0.5)),
                pandemiesActives: () => Math.max(0, Math.min(10, iehConfig.pandemiesActives.value + (Math.random() - 0.5) * 0.3)),
                risqueIA: () => Math.max(0, Math.min(10, iehConfig.risqueIA.value + (Math.random() - 0.5) * 0.3))
            };
            
            // Appliquer les variations
            for (const [key, fn] of Object.entries(variations)) {
                if (iehConfig[key]) {
                    iehConfig[key].value = parseFloat(fn().toFixed(1));
                }
            }
            
            // Mettre à jour l'affichage des métriques dans l'interface
            const guerresElement = document.querySelector('.global-stats .stat-item:nth-child(2) .stat-value');
            if (guerresElement) guerresElement.textContent = Math.round(iehConfig.guerresEntrePays.value + iehConfig.conflitsInternes.value);
            
            const tempElement = document.querySelector('.temp-display');
            if (tempElement) tempElement.textContent = `+${iehConfig.temperatureAnomalie.value.toFixed(1)}°C`;
            
            // Calculer et afficher le nouvel IEH
            updateIEHDisplay();
        }

        // Récupération de la population mondiale via World Bank API
        async function fetchWorldPopulation() {
            try {
                console.log('🌍 Récupération de la population mondiale...');
                const response = await fetch('https://api.worldbank.org/v2/world/indicator/SP.POP.TOTL?format=json&date=2023:2024&per_page=5');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('📊 Données population reçues:', data);
                
                if (data && data.length > 1 && data[1] && data[1].length > 0) {
                    // Prendre la donnée la plus récente disponible
                    const latestData = data[1][0];
                    const population = latestData.value;
                    const year = latestData.date;
                    
                    if (population) {
                        // Formater la population en milliards avec 1 décimale
                        const populationInBillions = (population / 1000000000).toFixed(1);
                        
                        // Mettre à jour l'affichage avec animation
                        const populationElement = document.querySelector('.global-stats .stat-item:first-child .stat-value');
                        const populationContainer = document.querySelector('.global-stats .stat-item:first-child');
                        
                        if (populationElement && populationContainer) {
                            // Animation de mise à jour
                            populationContainer.classList.add('updating');
                            
                            setTimeout(() => {
                                populationElement.textContent = `${populationInBillions}B`;
                                populationContainer.title = `Population mondiale ${year}: ${population.toLocaleString()} habitants (Banque Mondiale)`;
                                populationContainer.classList.remove('updating');
                                
                                // Mettre à jour la pop-up
                                updatePopulationPopup(population, year, true);
                            }, 500);
                        }
                        
                        console.log(`✅ Population mondiale mise à jour: ${populationInBillions}B (${year})`);
                        console.log(`📈 Population exacte: ${population.toLocaleString()}`);
                        
                        return {
                            population: population,
                            year: year,
                            formatted: `${populationInBillions}B`
                        };
                    }
                }
                throw new Error('Données de population non trouvées');
                
            } catch (error) {
                console.warn('⚠️ Erreur lors du chargement de la population mondiale:', error);
                console.log('🔄 Conservation de la valeur par défaut...');
                
                // Garder la valeur par défaut en cas d'erreur
                const populationElement = document.querySelector('.global-stats .stat-item:first-child .stat-value');
                if (populationElement) {
                    populationElement.title = 'Population mondiale (estimation par défaut)';
                    // Mettre à jour la pop-up avec les données par défaut
                    updatePopulationPopup(8100000000, '2024', false);
                }
                
                return null;
            }
        }

        // Fonction pour mettre à jour la pop-up de population
        function updatePopulationPopup(population, year, isLive) {
            const exactPopulationElement = document.getElementById('exactPopulation');
            const populationYearElement = document.getElementById('populationYear');
            const statusIndicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            
            if (exactPopulationElement) {
                exactPopulationElement.textContent = population.toLocaleString('fr-FR');
            }
            
            if (populationYearElement) {
                populationYearElement.textContent = year;
            }
            
            if (statusIndicator && statusText) {
                if (isLive) {
                    statusIndicator.className = 'status-indicator status-live';
                    statusText.textContent = 'Données en temps réel';
                } else {
                    statusIndicator.className = 'status-indicator status-cached';
                    statusText.textContent = 'Données par défaut';
                }
            }
        }

        // Fonction pour mettre à jour toutes les données externes
        async function updateExternalData() {
            console.log('🔄 Mise à jour des données externes...');
            
            // Lancer les deux requêtes en parallèle
            const [newsResult, populationResult] = await Promise.allSettled([
                fetchFrance24News(),
                fetchWorldPopulation()
            ]);
            
            // Logger les résultats
            if (newsResult.status === 'fulfilled') {
                console.log('✅ Nouvelles mises à jour');
            } else {
                console.log('⚠️ Erreur nouvelles:', newsResult.reason);
            }
            
            if (populationResult.status === 'fulfilled' && populationResult.value) {
                console.log('✅ Population mise à jour');
            } else {
                console.log('⚠️ Erreur population:', populationResult.reason);
            }
        }

        // Charger les données au démarrage
        updateExternalData();
        
        // Actualiser les données externes toutes les 10 minutes
        setInterval(updateExternalData, 600000);
        
        // Mélanger l'ordre d'affichage des nouvelles toutes les 2 minutes
        setInterval(updateNewsTicker, 120000);
        
        // Génération des graduations de la jauge
        function generateTicks() {
            const ticksContainer = document.getElementById('gaugeTicks');
            if (!ticksContainer) return;
            
            for (let i = 1; i <= 99; i++) {
                const tick = document.createElement('div');
                tick.className = 'tick';
                tick.style.left = `${(i / 99) * 100}%`;
                if (i % 10 === 0) {
                    tick.style.height = '25px';
                    tick.style.width = '3px';
                    tick.style.background = '#ffffff';
                    
                    // Ajouter les numéros pour les graduations principales
                    const label = document.createElement('div');
                    label.style.cssText = `
                        position: absolute;
                        top: 30px;
                        left: 50%;
                        transform: translateX(-50%);
                        color: rgba(255, 255, 255, 0.8);
                        font-size: 0.7rem;
                        font-weight: 700;
                    `;
                    label.textContent = i;
                    tick.appendChild(label);
                }
                ticksContainer.appendChild(tick);
            }
        }

        // Gestion du positionnement dynamique de la pop-up (version stable)
        function positionPopup() {
            const populationItem = document.querySelector('.population-item');
            const popup = document.getElementById('populationPopup');
            
            if (!populationItem || !popup) return;
            
            // Éviter les recalculs en boucle qui causent les scrollbars
            if (popup.dataset.positioning === 'true') return;
            popup.dataset.positioning = 'true';
            
            const rect = populationItem.getBoundingClientRect();
            
            // Utiliser des dimensions fixes pour éviter les recalculs
            const popupWidth = 280; // Largeur fixe de la pop-up
            const popupHeight = 200; // Hauteur approximative
            
            // Position de base : au-dessus de l'élément, centré
            let top = rect.top - popupHeight - 20;
            let left = rect.left + (rect.width / 2) - (popupWidth / 2);
            
            // Ajustements si la pop-up sort de l'écran
            if (top < 10) {
                // Si pas assez de place en haut, afficher en bas
                top = rect.bottom + 10;
                popup.classList.add('bottom');
            } else {
                popup.classList.remove('bottom');
            }
            
            if (left < 10) {
                // Si trop à gauche
                left = 10;
            } else if (left + popupWidth > window.innerWidth - 10) {
                // Si trop à droite
                left = window.innerWidth - popupWidth - 10;
            }
            
            popup.style.top = `${top}px`;
            popup.style.left = `${left}px`;
            
            // Réinitialiser le flag après un court délai
            setTimeout(() => {
                popup.dataset.positioning = 'false';
            }, 100);
        }

        // Event listeners pour le positionnement de la pop-up
        document.addEventListener('DOMContentLoaded', function() {
            generateTicks();
            updateIEHDisplay();
            // Initialiser la pop-up avec les données par défaut
            updatePopulationPopup(8100000000, '2024', false);
            
            // Ajouter les event listeners pour la pop-up
            const populationItem = document.querySelector('.population-item');
            if (populationItem) {
                let repositionTimer;
                populationItem.addEventListener('mouseenter', function() {
                    // Éviter les repositionnements multiples
                    clearTimeout(repositionTimer);
                    repositionTimer = setTimeout(positionPopup, 50);
                });
                
                populationItem.addEventListener('mouseleave', function() {
                    clearTimeout(repositionTimer);
                });
            }
            
            // Repositionner sur redimensionnement de fenêtre (avec throttling)
            let resizeTimer;
            window.addEventListener('resize', function() {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(positionPopup, 200);
            });
        });

        // Gestion de la modale des réserves de pétrole
        function showOilMap() {
            const modal = document.getElementById('oilMapModal');
            if (modal) {
                // Jouer le son d'ouverture
                expansionOpenSound.currentTime = 0;
                expansionOpenSound.play().catch(e => console.log('Erreur son ouverture:', e));
                
                // Fixer la position de scroll avant d'ouvrir la modale
                const scrollY = window.scrollY;
                document.body.style.position = 'fixed';
                document.body.style.top = `-${scrollY}px`;
                document.body.style.width = '100%';
                document.body.style.overflow = 'hidden';
                
                modal.classList.add('show');
                console.log('🛢️ Ouverture de la carte des réserves de pétrole');
            }
        }

        function closeOilMap() {
            const modal = document.getElementById('oilMapModal');
            if (modal) {
                // Jouer le son de fermeture
                expansionCloseSound.currentTime = 0;
                expansionCloseSound.play().catch(e => console.log('Erreur son fermeture:', e));
                
                modal.classList.remove('show');
                
                // Restaurer la position de scroll
                const scrollY = document.body.style.top;
                document.body.style.position = '';
                document.body.style.top = '';
                document.body.style.width = '';
                document.body.style.overflow = '';
                
                if (scrollY) {
                    window.scrollTo(0, parseInt(scrollY || '0') * -1);
                }
                
                console.log('🛢️ Fermeture de la carte des réserves de pétrole');
            }
        }



        // Gestion de la modale des conflits armés
        function showConflictsChart() {
            const modal = document.getElementById('conflictsChartModal');
            if (modal) {
                // Jouer le son d'ouverture
                expansionOpenSound.currentTime = 0;
                expansionOpenSound.play().catch(e => console.log('Erreur son ouverture:', e));
                
                // Fixer la position de scroll avant d'ouvrir la modale
                const scrollY = window.scrollY;
                document.body.style.position = 'fixed';
                document.body.style.top = `-${scrollY}px`;
                document.body.style.width = '100%';
                document.body.style.overflow = 'hidden';
                
                modal.classList.add('show');
                console.log('⚔️ Ouverture du graphique des conflits armés');
            }
        }

        function closeConflictsChart() {
            const modal = document.getElementById('conflictsChartModal');
            if (modal) {
                // Jouer le son de fermeture
                expansionCloseSound.currentTime = 0;
                expansionCloseSound.play().catch(e => console.log('Erreur son fermeture:', e));
                
                modal.classList.remove('show');
                
                // Restaurer la position de scroll
                const scrollY = document.body.style.top;
                document.body.style.position = '';
                document.body.style.top = '';
                document.body.style.width = '';
                document.body.style.overflow = '';
                
                if (scrollY) {
                    window.scrollTo(0, parseInt(scrollY || '0') * -1);
                }
                
                console.log('⚔️ Fermeture du graphique des conflits armés');
            }
        }

        // Gestion de la modale des réserves de gaz naturel
        function showGasMap() {
            const modal = document.getElementById('gasMapModal');
            if (modal) {
                // Jouer le son d'ouverture
                expansionOpenSound.currentTime = 0;
                expansionOpenSound.play().catch(e => console.log('Erreur son ouverture:', e));
                
                // Fixer la position de scroll avant d'ouvrir la modale
                const scrollY = window.scrollY;
                document.body.style.position = 'fixed';
                document.body.style.top = `-${scrollY}px`;
                document.body.style.width = '100%';
                document.body.style.overflow = 'hidden';
                
                modal.classList.add('show');
                console.log('🔥 Ouverture de la carte des réserves de gaz naturel');
            }
        }

        function closeGasMap() {
            const modal = document.getElementById('gasMapModal');
            if (modal) {
                // Jouer le son de fermeture
                expansionCloseSound.currentTime = 0;
                expansionCloseSound.play().catch(e => console.log('Erreur son fermeture:', e));
                
                modal.classList.remove('show');
                
                // Restaurer la position de scroll
                const scrollY = document.body.style.top;
                document.body.style.position = '';
                document.body.style.top = '';
                document.body.style.width = '';
                document.body.style.overflow = '';
                
                if (scrollY) {
                    window.scrollTo(0, parseInt(scrollY || '0') * -1);
                }
                
                console.log('🔥 Fermeture de la carte des réserves de gaz naturel');
            }
        }

        // Gestion de la modale des données climatiques
        function showClimateData() {
            const modal = document.getElementById('climateDataModal');
            if (modal) {
                // Jouer le son d'ouverture
                expansionOpenSound.currentTime = 0;
                expansionOpenSound.play().catch(e => console.log('Erreur son ouverture:', e));
                
                // Fixer la position de scroll avant d'ouvrir la modale
                const scrollY = window.scrollY;
                document.body.style.position = 'fixed';
                document.body.style.top = `-${scrollY}px`;
                document.body.style.width = '100%';
                document.body.style.overflow = 'hidden';
                
                modal.classList.add('show');
                console.log('🌡️ Ouverture des données climatiques mondiales');
            }
        }

        function closeClimateData() {
            const modal = document.getElementById('climateDataModal');
            if (modal) {
                // Jouer le son de fermeture
                expansionCloseSound.currentTime = 0;
                expansionCloseSound.play().catch(e => console.log('Erreur son fermeture:', e));
                
                modal.classList.remove('show');
                
                // Restaurer la position de scroll
                const scrollY = document.body.style.top;
                document.body.style.position = '';
                document.body.style.top = '';
                document.body.style.width = '';
                document.body.style.overflow = '';
                
                if (scrollY) {
                    window.scrollTo(0, parseInt(scrollY || '0') * -1);
                }
                
                console.log('🌡️ Fermeture des données climatiques mondiales');
            }
        }

        // Gestion de la modale d'analyse géopolitique
        function showGeopoliticalAnalysis() {
            const modal = document.getElementById('geopoliticalModal');
            if (modal) {
                // Jouer le son d'ouverture
                expansionOpenSound.currentTime = 0;
                expansionOpenSound.play().catch(e => console.log('Erreur son ouverture:', e));
                
                // Fixer la position de scroll avant d'ouvrir la modale
                const scrollY = window.scrollY;
                document.body.style.position = 'fixed';
                document.body.style.top = `-${scrollY}px`;
                document.body.style.width = '100%';
                document.body.style.overflow = 'hidden';
                
                modal.classList.add('show');
                console.log('🌍 Ouverture de l\'analyse géopolitique mondiale');
            }
        }

        function closeGeopoliticalAnalysis() {
            const modal = document.getElementById('geopoliticalModal');
            if (modal) {
                // Jouer le son de fermeture
                expansionCloseSound.currentTime = 0;
                expansionCloseSound.play().catch(e => console.log('Erreur son fermeture:', e));
                
                modal.classList.remove('show');
                
                // Restaurer la position de scroll
                const scrollY = document.body.style.top;
                document.body.style.position = '';
                document.body.style.top = '';
                document.body.style.width = '';
                document.body.style.overflow = '';
                
                if (scrollY) {
                    window.scrollTo(0, parseInt(scrollY || '0') * -1);
                }
                
                console.log('🌍 Fermeture de l\'analyse géopolitique mondiale');
            }
        }

        // Fonction pour gérer l'accordéon des continents
        function toggleContinentSection(continentId) {
            const textElement = document.getElementById(continentId + '-text');
            const cardElement = textElement.parentElement;
            
            if (textElement.style.display === 'none' || textElement.style.display === '') {
                // Ouvrir la section
                textElement.style.display = 'block';
                cardElement.classList.add('expanded');
                console.log(`📖 Ouverture de la section ${continentId}`);
            } else {
                // Fermer la section
                textElement.style.display = 'none';
                cardElement.classList.remove('expanded');
                console.log(`📕 Fermeture de la section ${continentId}`);
            }
        }

        // Fermer les modales en cliquant sur le fond
        document.addEventListener('click', function(event) {
            const oilModal = document.getElementById('oilMapModal');
            const conflictsModal = document.getElementById('conflictsChartModal');
            const gasModal = document.getElementById('gasMapModal');
            const climateModal = document.getElementById('climateDataModal');
            const geopoliticalModal = document.getElementById('geopoliticalModal');
            
            if (event.target === oilModal) {
                closeOilMap();
            } else if (event.target === conflictsModal) {
                closeConflictsChart();
            } else if (event.target === gasModal) {
                closeGasMap();
            } else if (event.target === climateModal) {
                closeClimateData();
            } else if (event.target === geopoliticalModal) {
                closeGeopoliticalAnalysis();
            }
        });

        // Fermer les modales avec la touche Escape
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeOilMap();
                closeConflictsChart();
                closeGasMap();
                closeClimateData();
                closeGeopoliticalAnalysis();
            }
        });

        // Calculer l'IEH initial et le mettre à jour régulièrement
        updateIEHDisplay();
        setInterval(updateMetrics, 30000); // Mise à jour toutes les 30 secondes
    </script>
</body>
</html>