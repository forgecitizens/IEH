<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de Bord Planétaire</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 60px 0 0 0;
            font-family: 'Orbitron', monospace;
            background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(90deg, rgba(0, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(rgba(0, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: -1;
        }

        .dashboard-container {
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            grid-template-rows: auto auto auto;
            gap: 20px;
            grid-template-areas: 
                "extinction extinction extinction"
                "global resources climate"
                "conflicts conflicts health";
        }

        .section {
            background: rgba(15, 25, 45, 0.8);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: visible; /* Permet à la pop-up de sortir */
        }

        /* Override pour la ligne de scan qui a besoin d'overflow hidden */
        .section::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #00ffff, transparent);
            animation: scanLine 3s infinite;
            overflow: hidden; /* Contient seulement la ligne de scan */
        }



        @keyframes scanLine {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .section:hover {
            border-color: rgba(0, 255, 255, 0.6);
            box-shadow: 0 12px 40px rgba(0, 255, 255, 0.2);
        }

        .extinction-section {
            grid-area: extinction;
            text-align: center;
            padding: 30px;
        }

        .extinction-title {
            font-size: 2rem;
            font-weight: 900;
            color: #00ffff;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }

        .gauge-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            height: 120px;
        }

        .gauge-background {
            width: 100%;
            height: 60px;
            background: linear-gradient(to right, 
                #00ff00 0%, #00ff00 10%,
                #7fff00 10%, #7fff00 30%,
                #ffff00 30%, #ffff00 50%,
                #ff8c00 50%, #ff8c00 70%,
                #ff4500 70%, #ff4500 89%,
                #ff0000 89%, #ff0000 100%);
            border-radius: 30px;
            position: relative;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .gauge-ticks {
            position: absolute;
            top: -10px;
            width: 100%;
            height: 80px;
        }

        .tick {
            position: absolute;
            width: 2px;
            height: 15px;
            background: rgba(255, 255, 255, 0.7);
            top: 0;
        }

        .gauge-needle {
            position: absolute;
            top: -20px;
            left: 22%;
            width: 4px;
            height: 100px;
            background: linear-gradient(to bottom, #ffffff, #00ffff);
            border-radius: 2px;
            transform-origin: bottom center;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.8);
            animation: needleGlow 2s ease-in-out infinite alternate;
            transition: left 2s ease-out;
        }

        @keyframes needleGlow {
            0% { box-shadow: 0 0 15px rgba(0, 255, 255, 0.8); }
            100% { box-shadow: 0 0 25px rgba(0, 255, 255, 1); }
        }

        .gauge-value {
            font-size: 3rem;
            font-weight: 900;
            color: #00ff00;
            margin-top: 20px;
            text-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
        }

        .global-section {
            grid-area: global;
            overflow: visible; /* Permet à la pop-up de sortir du container */
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #00ffff;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .global-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .stat-item {
            background: rgba(0, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #00ffff;
            transition: all 0.3s ease;
            cursor: help;
        }

        .stat-item:hover {
            background: rgba(0, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 255, 255, 0.3);
        }

        .stat-item.updating {
            animation: data-update 1s ease-in-out;
        }

        @keyframes data-update {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; transform: scale(1.05); }
        }

        /* Population popup styling */
        .population-popup {
            position: fixed; /* Utilisation de fixed pour sortir complètement du flow */
            top: auto;
            left: auto;
            background: rgba(15, 25, 45, 0.95);
            border: 2px solid rgba(0, 255, 255, 0.6);
            border-radius: 12px;
            padding: 15px;
            min-width: 280px;
            backdrop-filter: blur(15px);
            box-shadow: 0 8px 32px rgba(0, 255, 255, 0.3);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 9999; /* Z-index très élevé pour être au-dessus de tout */
            font-family: 'Orbitron', monospace;
            pointer-events: none; /* Évite les problèmes d'interaction */
        }

        .stat-item:hover .population-popup {
            pointer-events: auto; /* Réactive les interactions au hover */
        }

        .population-popup::before {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 8px solid rgba(0, 255, 255, 0.6);
            transition: all 0.3s ease;
        }

        .population-popup::after {
            content: '';
            position: absolute;
            bottom: -6px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid rgba(15, 25, 45, 0.95);
            transition: all 0.3s ease;
        }

        /* Variante quand la pop-up est en bas (flèche vers le haut) */
        .population-popup.bottom::before {
            bottom: auto;
            top: -8px;
            border-top: none;
            border-bottom: 8px solid rgba(0, 255, 255, 0.6);
        }

        .population-popup.bottom::after {
            bottom: auto;
            top: -6px;
            border-top: none;
            border-bottom: 6px solid rgba(15, 25, 45, 0.95);
        }

        .stat-item:hover .population-popup {
            opacity: 1;
            visibility: visible;
        }

        .popup-title {
            color: #00ffff;
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 10px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .popup-data {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .popup-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            border-bottom: 1px solid rgba(0, 255, 255, 0.2);
        }

        .popup-row:last-child {
            border-bottom: none;
        }

        .popup-label {
            color: #aaaaaa;
            font-size: 0.75rem;
        }

        .popup-value {
            color: #ffffff;
            font-weight: 700;
            font-size: 0.8rem;
        }

        .popup-link {
            margin-top: 10px;
            text-align: center;
        }

        .popup-link a {
            color: #00ffff;
            text-decoration: none;
            font-size: 0.7rem;
            padding: 5px 10px;
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 4px;
            transition: all 0.3s ease;
            display: inline-block;
        }

        .popup-link a:hover {
            background: rgba(0, 255, 255, 0.2);
            border-color: rgba(0, 255, 255, 0.6);
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
            animation: pulse-dot 2s ease-in-out infinite;
        }

        .status-live {
            background: #00ff00;
        }

        .status-cached {
            background: #ffaa00;
        }

        @keyframes pulse-dot {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Oil reserves map modal */
        .oil-map-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .oil-map-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .oil-map-container {
            background: rgba(15, 25, 45, 0.95);
            border: 2px solid rgba(255, 140, 0, 0.6);
            border-radius: 15px;
            padding: 20px;
            max-width: 90vw;
            max-height: 90vh;
            width: 1000px;
            height: 700px;
            position: relative;
            box-shadow: 0 20px 60px rgba(255, 140, 0, 0.3);
            animation: modal-appear 0.5s ease-out;
        }

        @keyframes modal-appear {
            from {
                transform: scale(0.8) translateY(50px);
                opacity: 0;
            }
            to {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        .oil-map-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 140, 0, 0.3);
        }

        .oil-map-title {
            color: #ff8c00;
            font-size: 1.2rem;
            font-weight: 700;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .oil-map-close {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid rgba(255, 0, 0, 0.5);
            color: #ff6464;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .oil-map-close:hover {
            background: rgba(255, 0, 0, 0.4);
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
        }

        .oil-map-iframe {
            width: 100%;
            height: 600px;
            border: 1px solid rgba(255, 140, 0, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
        }

        .oil-resource-hover {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .oil-resource-hover:hover {
            background: rgba(255, 140, 0, 0.2);
            border-color: rgba(255, 140, 0, 0.6);
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(255, 140, 0, 0.3);
        }

        .oil-resource-hover:hover .resource-label {
            color: #ff8c00;
            font-weight: 700;
        }

        /* Instructions pour l'utilisateur */
        .oil-map-instructions {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.8rem;
            text-align: center;
            font-family: 'Orbitron', monospace;
        }

        @media (max-width: 768px) {
            .oil-map-container {
                width: 95vw;
                height: 80vh;
                padding: 15px;
            }

            .oil-map-title {
                font-size: 1rem;
            }
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #ffffff;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #aaaaaa;
            text-transform: uppercase;
        }

        .resources-section {
            grid-area: resources;
        }

        .resource-bar {
            margin: 15px 0;
        }

        .resource-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .resource-progress {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .resource-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 2s ease;
        }

        .oil-fill { background: linear-gradient(90deg, #ff8c00, #ffaa00); width: 45%; }
        .gas-fill { background: linear-gradient(90deg, #4169e1, #6495ed); width: 62%; }
        .water-fill { background: linear-gradient(90deg, #00bfff, #87ceeb); width: 78%; }

        .climate-section {
            grid-area: climate;
        }

        .climate-indicator {
            text-align: center;
            margin: 20px 0;
        }

        .temp-display {
            font-size: 2.5rem;
            font-weight: 900;
            color: #ff4500;
            text-shadow: 0 0 15px rgba(255, 69, 0, 0.5);
        }

        .conflicts-section {
            grid-area: conflicts;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .conflict-subsection {
            background: rgba(255, 0, 100, 0.1);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 0, 100, 0.3);
        }

        .conflict-counter {
            font-size: 2rem;
            font-weight: 900;
            color: #ff0066;
            text-align: center;
            margin: 10px 0;
        }

        .health-section {
            grid-area: health;
        }

        @media (max-width: 768px) {
            .dashboard-container {
                grid-template-columns: 1fr;
                grid-template-areas: 
                    "extinction"
                    "global"
                    "resources"
                    "climate"
                    "conflicts"
                    "health";
            }

            .conflicts-section {
                grid-template-columns: 1fr;
            }

            .extinction-title {
                font-size: 1.5rem;
            }

            .gauge-value {
                font-size: 2rem;
            }
        }
        /* Audio controls styling */
        .audio-controls {
            position: fixed;
            top: 70px;
            right: 20px;
            z-index: 1000;
            background: rgba(15, 25, 45, 0.9);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 8px;
            padding: 10px;
            backdrop-filter: blur(10px);
        }

        .audio-controls button {
            background: rgba(0, 255, 255, 0.2);
            border: 1px solid rgba(0, 255, 255, 0.5);
            color: #00ffff;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Orbitron', monospace;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .audio-controls button:hover {
            background: rgba(0, 255, 255, 0.4);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        }

        .audio-controls button:active {
            transform: scale(0.95);
        }

        /* Credits styling */
        .credits {
            position: fixed;
            bottom: 10px;
            left: 10px;
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.6);
            background: rgba(0, 0, 0, 0.7);
            padding: 8px;
            border-radius: 4px;
            max-width: 400px;
            z-index: 1000;
        }

        .credits a {
            color: #00ffff;
            text-decoration: none;
        }

        .credits a:hover {
            text-decoration: underline;
        }

        /* News ticker styling */
        .news-ticker {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 50px;
            background: linear-gradient(90deg, #ff0000, #ff4500, #ff0000);
            color: white;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            overflow: hidden;
            z-index: 2000;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 20px rgba(255, 0, 0, 0.3);
        }

        .news-ticker::before {
            content: '🚨 BREAKING NEWS';
            background: rgba(0, 0, 0, 0.8);
            padding: 0 15px;
            height: 100%;
            display: flex;
            align-items: center;
            flex-shrink: 0;
            border-right: 2px solid rgba(255, 255, 255, 0.5);
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
        }

        .news-ticker {
            position: relative;
        }

        #newsStatus {
            animation: pulse-status 2s ease-in-out infinite alternate;
        }

        @keyframes pulse-status {
            0% { opacity: 0.6; }
            100% { opacity: 1; }
        }

        .news-content {
            white-space: nowrap;
            animation: scroll-left 150s linear infinite;
            padding-left: 20px;
            display: flex;
            align-items: center;
        }

        @keyframes scroll-left {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        .news-item {
            margin-right: 80px;
            display: inline-block;
        }

        .news-item::before {
            content: '●';
            color: #00ffff;
            margin-right: 10px;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
        }

        @media (max-width: 768px) {
            body {
                padding-top: 50px;
            }

            .audio-controls {
                top: 60px;
                right: 10px;
                padding: 8px;
            }

            .credits {
                font-size: 0.6rem;
                max-width: 300px;
            }

            .news-ticker {
                height: 40px;
                font-size: 0.8rem;
            }

            .news-content {
                animation-duration: 115s; /* Proportionnellement plus lent */
            }
        }
    </style>
</head>
<body>
    <!-- Audio Background -->
    <audio id="backgroundAudio" loop preload="auto">
        <source src="sounds/212025__qubodup__sci-fi-laboratory-ambience.ogg" type="audio/ogg">
        <source src="sounds/212025__qubodup__sci-fi-laboratory-ambience.mp3" type="audio/mpeg">
    </audio>

    <!-- Audio Controls -->
    <div class="audio-controls">
        <button id="audioToggle" onclick="toggleAudio()">🔊 AUDIO ON</button>
    </div>

    <!-- Credits -->
    <div class="credits">
        Audio: <a href="http://freesound.org/people/qubodup/sounds/212025">Sci-fi Laboratory Ambience</a> by <a href="http://freesound.org/people/qubodup">Iwan Gabovitch</a> under <a href="http://creativecommons.org/licenses/by/3.0/legalcode">CC-BY 3.0 License</a> with sounds by wolick, swiftoid, Diboz
    </div>

    <!-- News Ticker -->
    <div class="news-ticker">
        <div class="news-content" id="newsContent">
            <span class="news-item">🔄 Chargement des dernières nouvelles France24...</span>
        </div>
    </div>

    <!-- Oil Map Modal -->
    <div class="oil-map-modal" id="oilMapModal">
        <div class="oil-map-container">
            <div class="oil-map-header">
                <div class="oil-map-title">🛢️ Réserves Mondiales de Pétrole</div>
                <button class="oil-map-close" onclick="closeOilMap()">×</button>
            </div>
            <iframe src="https://ourworldindata.org/grapher/oil-proved-reserves?tab=map" 
                    loading="lazy" 
                    style="width: 100%; height: 600px; border: 0px none;" 
                    allow="web-share; clipboard-write"
                    class="oil-map-iframe">
            </iframe>
            <div class="oil-map-instructions">
                Cliquez sur × pour fermer • Données: Our World in Data
            </div>
        </div>
    </div>

    <div class="dashboard-container">
        <div class="section extinction-section">
            <h1 class="extinction-title">INDICE D'EXTINCTION DE L'HUMANITÉ</h1>
            <div class="gauge-container">
                <div class="gauge-background">
                    <div class="gauge-ticks" id="gaugeTicks"></div>
                    <div class="gauge-needle" id="gaugeNeedle"></div>
                </div>
            </div>
            <div class="gauge-value">22 / 99</div>
        </div>

        <div class="section global-section">
            <h2 class="section-title">🌍 Statut Global</h2>
            <div class="global-stats">
                <div class="stat-item population-item" title="Population mondiale (Banque Mondiale)">
                    <div class="stat-value" id="populationValue">8.1B</div>
                    <div class="stat-label">Population 🌍</div>
                    <div class="population-popup" id="populationPopup">
                        <div class="popup-title">🌍 Population Mondiale</div>
                        <div class="popup-data">
                            <div class="popup-row">
                                <span class="popup-label">Population exacte:</span>
                                <span class="popup-value" id="exactPopulation">Chargement...</span>
                            </div>
                            <div class="popup-row">
                                <span class="popup-label">Année de référence:</span>
                                <span class="popup-value" id="populationYear">-</span>
                            </div>
                            <div class="popup-row">
                                <span class="popup-label">Source:</span>
                                <span class="popup-value">Banque Mondiale</span>
                            </div>
                            <div class="popup-row">
                                <span class="popup-label">Statut:</span>
                                <span class="popup-value">
                                    <span class="status-indicator status-cached" id="statusIndicator"></span>
                                    <span id="statusText">Données par défaut</span>
                                </span>
                            </div>
                        </div>
                        <div class="popup-link">
                            <a href="https://data.worldbank.org/indicator/SP.POP.TOTL" target="_blank" rel="noopener">
                                🔗 Voir sur worldbank.org
                            </a>
                        </div>
                    </div>
                </div>
                <div class="stat-item" title="Conflits armés internationaux actifs">
                    <div class="stat-value">12</div>
                    <div class="stat-label">Guerres Actives</div>
                </div>
                <div class="stat-item" title="Ressources en situation critique">
                    <div class="stat-value">847</div>
                    <div class="stat-label">Ressources Critiques</div>
                </div>
                <div class="stat-item" title="Pourcentage de régions stables">
                    <div class="stat-value">73%</div>
                    <div class="stat-label">Stabilité Régionale</div>
                </div>
            </div>
        </div>

        <div class="section resources-section">
            <h2 class="section-title">⚡ Ressources & Énergie</h2>
            <div class="resource-bar oil-resource-hover" onclick="showOilMap()" title="Cliquez pour voir la carte des réserves mondiales">
                <div class="resource-label">
                    <span>🛢️ Pétrole</span>
                    <span>45%</span>
                </div>
                <div class="resource-progress">
                    <div class="resource-fill oil-fill"></div>
                </div>
            </div>
            <div class="resource-bar">
                <div class="resource-label">
                    <span>🔥 Gaz Naturel</span>
                    <span>62%</span>
                </div>
                <div class="resource-progress">
                    <div class="resource-fill gas-fill"></div>
                </div>
            </div>
            <div class="resource-bar">
                <div class="resource-label">
                    <span>💧 Eau Douce</span>
                    <span>78%</span>
                </div>
                <div class="resource-progress">
                    <div class="resource-fill water-fill"></div>
                </div>
            </div>
        </div>

        <div class="section climate-section">
            <h2 class="section-title">🌡️ Climat & Biodiversité</h2>
            <div class="climate-indicator">
                <div class="stat-label">Anomalie Température</div>
                <div class="temp-display">+1.8°C</div>
            </div>
        </div>

        <div class="section conflicts-section">
            <div class="conflict-subsection">
                <h3 class="section-title">⚔️ Conflits</h3>
                <div class="conflict-counter">12</div>
                <div class="stat-label">Guerres Actives</div>
                <div class="conflict-counter">47</div>
                <div class="stat-label">Tensions Internes</div>
            </div>
            <div class="conflict-subsection">
                <h3 class="section-title">☢️ Risques Tech</h3>
            </div>
        </div>

        <div class="section health-section">
            <h2 class="section-title">🧬 Santé & Stabilité</h2>
            <div class="stat-item">
                <div class="stat-value">2</div>
                <div class="stat-label">Pandémies Actives</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">84%</div>
                <div class="stat-label">Résilience Infrastructure</div>
            </div>
        </div>
    </div>

    <script>
        let audioEnabled = false;
        const audio = document.getElementById('backgroundAudio');
        const audioToggle = document.getElementById('audioToggle');

        // Initialize audio
        audio.volume = 0.3; // Volume à 30% pour ne pas être trop fort

        function toggleAudio() {
            if (audioEnabled) {
                audio.pause();
                audioToggle.innerHTML = '🔇 AUDIO OFF';
                audioToggle.style.background = 'rgba(255, 100, 100, 0.2)';
                audioToggle.style.borderColor = 'rgba(255, 100, 100, 0.5)';
                audioToggle.style.color = '#ff6464';
                audioEnabled = false;
            } else {
                audio.play().catch(e => {
                    console.log('Erreur lecture audio:', e);
                    alert('Impossible de lire l\'audio. Votre navigateur bloque peut-être la lecture automatique.');
                });
                audioToggle.innerHTML = '🔊 AUDIO ON';
                audioToggle.style.background = 'rgba(0, 255, 255, 0.2)';
                audioToggle.style.borderColor = 'rgba(0, 255, 255, 0.5)';
                audioToggle.style.color = '#00ffff';
                audioEnabled = true;
            }
        }

        // Auto-start audio après interaction utilisateur (requis par les navigateurs modernes)
        document.addEventListener('click', function startAudio() {
            if (!audioEnabled) {
                toggleAudio();
            }
            document.removeEventListener('click', startAudio);
        }, { once: true });

        // Gestion des erreurs audio
        audio.addEventListener('error', function(e) {
            console.log('Erreur audio:', e);
            audioToggle.innerHTML = '❌ AUDIO ERROR';
            audioToggle.disabled = true;
        });

        // News ticker functionality with France24 RSS feed
        const fallbackNews = [
            "Tensions nucléaires en hausse : 3 pays placent leurs forces en alerte maximale",
            "Réchauffement climatique : nouveau record de +2.1°C atteint ce mois",
            "Crise énergétique mondiale : les réserves de pétrole chutent à 42%",
            "Pandémie H7N3 : 12 nouveaux foyers détectés en Asie du Sud-Est",
            "IA militaire : première utilisation autonome signalée dans un conflit",
            "Effondrement de la biodiversité : 15 espèces déclarées éteintes cette semaine"
        ];

        let currentNewsItems = [...fallbackNews];

        async function fetchFrance24News() {
            try {
                console.log('🔄 Récupération des nouvelles France24...');
                const response = await fetch('https://api.rss2json.com/v1/api.json?rss_url=https://www.france24.com/fr/rss');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('📰 Données reçues:', data);
                
                if (data.status === 'ok' && data.items && data.items.length > 0) {
                    // Extraire les titres et nettoyer le HTML
                    currentNewsItems = data.items.slice(0, 10).map(item => {
                        // Nettoyer le titre des balises HTML
                        const cleanTitle = item.title.replace(/<[^>]*>/g, '').trim();
                        return cleanTitle;
                    });
                    
                    console.log('✅ Nouvelles France24 chargées:', currentNewsItems.length);
                    updateNewsTicker();
                    
                    // Mettre à jour l'indicateur de statut
                    updateNewsStatus('LIVE FRANCE24', '#00ff00');
                } else {
                    throw new Error('Format de données invalide');
                }
            } catch (error) {
                console.warn('⚠️ Erreur lors du chargement des nouvelles France24:', error);
                console.log('🔄 Utilisation des nouvelles de secours...');
                currentNewsItems = [...fallbackNews];
                updateNewsTicker();
                updateNewsStatus('NOUVELLES LOCALES', '#ffaa00');
            }
        }

        function updateNewsTicker() {
            const newsContent = document.getElementById('newsContent');
            const shuffledNews = [...currentNewsItems].sort(() => Math.random() - 0.5);
            
            newsContent.innerHTML = shuffledNews.map(item => 
                `<span class="news-item">${item}</span>`
            ).join('');
        }

        function updateNewsStatus(status, color) {
            const ticker = document.querySelector('.news-ticker');
            const statusElement = ticker.querySelector('::before') || ticker;
            
            // Créer un indicateur de statut si il n'existe pas
            let statusIndicator = document.getElementById('newsStatus');
            if (!statusIndicator) {
                statusIndicator = document.createElement('div');
                statusIndicator.id = 'newsStatus';
                statusIndicator.style.cssText = `
                    position: absolute;
                    right: 10px;
                    top: 50%;
                    transform: translateY(-50%);
                    font-size: 0.7rem;
                    opacity: 0.8;
                    display: flex;
                    align-items: center;
                `;
                ticker.appendChild(statusIndicator);
            }
            
            statusIndicator.innerHTML = `<span style="color: ${color}">● ${status}</span>`;
        }

        // Système de calcul IEH (Indice d'Extinction de l'Humanité)
        const iehConfig = {
            guerresEntrePays: { value: 3, max: 10, weight: 10 },
            conflitsInternes: { value: 12, max: 50, weight: 8 },
            petroleDisponible: { value: 45, max: 100, weight: 6, inverse: true }, // 45% = pénurie
            gazDisponible: { value: 62, max: 100, weight: 5, inverse: true },
            eauDisponible: { value: 78, max: 100, weight: 12, inverse: true },
            temperatureAnomalie: { value: 1.8, max: 5, weight: 18 },
            biodiversitePerdue: { value: 60, max: 100, weight: 12 },
            tensionNucleaire: { value: 6, max: 10, weight: 15 },
            pandemiesActives: { value: 2, max: 10, weight: 6 },
            risqueIA: { value: 4, max: 10, weight: 8 }
        };

        function calculateIEH() {
            let totalContribution = 0;
            let totalWeight = 0;
            
            console.log('🧮 Calcul IEH en cours...');
            
            for (const [key, config] of Object.entries(iehConfig)) {
                let normalizedValue;
                
                if (config.inverse) {
                    // Pour les ressources : plus c'est bas, plus c'est dangereux
                    normalizedValue = 1 - (config.value / 100);
                } else {
                    // Pour les menaces : plus c'est haut, plus c'est dangereux
                    normalizedValue = config.value / config.max;
                }
                
                const contribution = config.weight * normalizedValue;
                totalContribution += contribution;
                totalWeight += config.weight;
                
                console.log(`📊 ${key}: ${config.value} → normalized: ${normalizedValue.toFixed(3)} → contrib: ${contribution.toFixed(2)}`);
            }
            
            // Score normalisé sur la somme des poids max (100)
            const normalizedScore = totalContribution / 100;
            
            // Conversion en IEH (1 à 99)
            const ieh = Math.max(1, Math.min(99, 1 + Math.round(normalizedScore * 98)));
            
            console.log(`🎯 Score total: ${totalContribution.toFixed(2)}/100`);
            console.log(`📈 Score normalisé: ${normalizedScore.toFixed(4)}`);
            console.log(`⚠️ IEH calculé: ${ieh}/99`);
            
            return {
                ieh: ieh,
                score: normalizedScore,
                totalContribution: totalContribution,
                details: Object.entries(iehConfig).map(([key, config]) => ({
                    name: key,
                    value: config.value,
                    contribution: config.weight * (config.inverse ? 1 - (config.value / 100) : config.value / config.max)
                }))
            };
        }

        function updateIEHDisplay() {
            const result = calculateIEH();
            const gaugeValue = document.getElementById('gaugeValue');
            const gaugeNeedle = document.getElementById('gaugeNeedle');
            
            // Mettre à jour l'affichage
            gaugeValue.textContent = `${result.ieh} / 99`;
            
            // Positionner l'aiguille (position en pourcentage)
            const needlePosition = (result.ieh / 99) * 100;
            gaugeNeedle.style.left = `${needlePosition}%`;
            
            // Changer la couleur selon le niveau de danger
            let color, textShadow;
            if (result.ieh <= 20) {
                color = '#00ff00'; // Vert - situation stable
                textShadow = '0 0 20px rgba(0, 255, 0, 0.5)';
            } else if (result.ieh <= 40) {
                color = '#7fff00'; // Vert-jaune - préoccupant
                textShadow = '0 0 20px rgba(127, 255, 0, 0.5)';
            } else if (result.ieh <= 60) {
                color = '#ffff00'; // Jaune - dangereux
                textShadow = '0 0 20px rgba(255, 255, 0, 0.5)';
            } else if (result.ieh <= 80) {
                color = '#ff8c00'; // Orange - très dangereux
                textShadow = '0 0 20px rgba(255, 140, 0, 0.5)';
            } else {
                color = '#ff0000'; // Rouge - critique
                textShadow = '0 0 20px rgba(255, 0, 0, 0.8)';
            }
            
            gaugeValue.style.color = color;
            gaugeValue.style.textShadow = textShadow;
            
            return result;
        }

        function updateMetrics() {
            // Simuler de légères variations dans les métriques
            const variations = {
                guerresEntrePays: () => Math.max(0, Math.min(10, iehConfig.guerresEntrePays.value + (Math.random() - 0.5) * 0.2)),
                conflitsInternes: () => Math.max(0, Math.min(50, iehConfig.conflitsInternes.value + (Math.random() - 0.5) * 2)),
                temperatureAnomalie: () => Math.max(0, Math.min(5, iehConfig.temperatureAnomalie.value + (Math.random() - 0.5) * 0.1)),
                tensionNucleaire: () => Math.max(0, Math.min(10, iehConfig.tensionNucleaire.value + (Math.random() - 0.5) * 0.5)),
                pandemiesActives: () => Math.max(0, Math.min(10, iehConfig.pandemiesActives.value + (Math.random() - 0.5) * 0.3)),
                risqueIA: () => Math.max(0, Math.min(10, iehConfig.risqueIA.value + (Math.random() - 0.5) * 0.3))
            };
            
            // Appliquer les variations
            for (const [key, fn] of Object.entries(variations)) {
                if (iehConfig[key]) {
                    iehConfig[key].value = parseFloat(fn().toFixed(1));
                }
            }
            
            // Mettre à jour l'affichage des métriques dans l'interface
            const guerresElement = document.querySelector('.global-stats .stat-item:nth-child(2) .stat-value');
            if (guerresElement) guerresElement.textContent = Math.round(iehConfig.guerresEntrePays.value + iehConfig.conflitsInternes.value);
            
            const tempElement = document.querySelector('.temp-display');
            if (tempElement) tempElement.textContent = `+${iehConfig.temperatureAnomalie.value.toFixed(1)}°C`;
            
            // Calculer et afficher le nouvel IEH
            updateIEHDisplay();
        }

        // Récupération de la population mondiale via World Bank API
        async function fetchWorldPopulation() {
            try {
                console.log('🌍 Récupération de la population mondiale...');
                const response = await fetch('https://api.worldbank.org/v2/world/indicator/SP.POP.TOTL?format=json&date=2023:2024&per_page=5');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('📊 Données population reçues:', data);
                
                if (data && data.length > 1 && data[1] && data[1].length > 0) {
                    // Prendre la donnée la plus récente disponible
                    const latestData = data[1][0];
                    const population = latestData.value;
                    const year = latestData.date;
                    
                    if (population) {
                        // Formater la population en milliards avec 1 décimale
                        const populationInBillions = (population / 1000000000).toFixed(1);
                        
                        // Mettre à jour l'affichage avec animation
                        const populationElement = document.querySelector('.global-stats .stat-item:first-child .stat-value');
                        const populationContainer = document.querySelector('.global-stats .stat-item:first-child');
                        
                        if (populationElement && populationContainer) {
                            // Animation de mise à jour
                            populationContainer.classList.add('updating');
                            
                            setTimeout(() => {
                                populationElement.textContent = `${populationInBillions}B`;
                                populationContainer.title = `Population mondiale ${year}: ${population.toLocaleString()} habitants (Banque Mondiale)`;
                                populationContainer.classList.remove('updating');
                                
                                // Mettre à jour la pop-up
                                updatePopulationPopup(population, year, true);
                            }, 500);
                        }
                        
                        console.log(`✅ Population mondiale mise à jour: ${populationInBillions}B (${year})`);
                        console.log(`📈 Population exacte: ${population.toLocaleString()}`);
                        
                        return {
                            population: population,
                            year: year,
                            formatted: `${populationInBillions}B`
                        };
                    }
                }
                throw new Error('Données de population non trouvées');
                
            } catch (error) {
                console.warn('⚠️ Erreur lors du chargement de la population mondiale:', error);
                console.log('🔄 Conservation de la valeur par défaut...');
                
                // Garder la valeur par défaut en cas d'erreur
                const populationElement = document.querySelector('.global-stats .stat-item:first-child .stat-value');
                if (populationElement) {
                    populationElement.title = 'Population mondiale (estimation par défaut)';
                    // Mettre à jour la pop-up avec les données par défaut
                    updatePopulationPopup(8100000000, '2024', false);
                }
                
                return null;
            }
        }

        // Fonction pour mettre à jour la pop-up de population
        function updatePopulationPopup(population, year, isLive) {
            const exactPopulationElement = document.getElementById('exactPopulation');
            const populationYearElement = document.getElementById('populationYear');
            const statusIndicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            
            if (exactPopulationElement) {
                exactPopulationElement.textContent = population.toLocaleString('fr-FR');
            }
            
            if (populationYearElement) {
                populationYearElement.textContent = year;
            }
            
            if (statusIndicator && statusText) {
                if (isLive) {
                    statusIndicator.className = 'status-indicator status-live';
                    statusText.textContent = 'Données en temps réel';
                } else {
                    statusIndicator.className = 'status-indicator status-cached';
                    statusText.textContent = 'Données par défaut';
                }
            }
        }

        // Fonction pour mettre à jour toutes les données externes
        async function updateExternalData() {
            console.log('🔄 Mise à jour des données externes...');
            
            // Lancer les deux requêtes en parallèle
            const [newsResult, populationResult] = await Promise.allSettled([
                fetchFrance24News(),
                fetchWorldPopulation()
            ]);
            
            // Logger les résultats
            if (newsResult.status === 'fulfilled') {
                console.log('✅ Nouvelles mises à jour');
            } else {
                console.log('⚠️ Erreur nouvelles:', newsResult.reason);
            }
            
            if (populationResult.status === 'fulfilled' && populationResult.value) {
                console.log('✅ Population mise à jour');
            } else {
                console.log('⚠️ Erreur population:', populationResult.reason);
            }
        }

        // Charger les données au démarrage
        updateExternalData();
        
        // Actualiser les données externes toutes les 10 minutes
        setInterval(updateExternalData, 600000);
        
        // Mélanger l'ordre d'affichage des nouvelles toutes les 2 minutes
        setInterval(updateNewsTicker, 120000);
        
        // Génération des graduations de la jauge
        function generateTicks() {
            const ticksContainer = document.getElementById('gaugeTicks');
            if (!ticksContainer) return;
            
            for (let i = 1; i <= 99; i++) {
                const tick = document.createElement('div');
                tick.className = 'tick';
                tick.style.left = `${(i / 99) * 100}%`;
                if (i % 10 === 0) {
                    tick.style.height = '25px';
                    tick.style.width = '3px';
                    tick.style.background = '#ffffff';
                    
                    // Ajouter les numéros pour les graduations principales
                    const label = document.createElement('div');
                    label.style.cssText = `
                        position: absolute;
                        top: 30px;
                        left: 50%;
                        transform: translateX(-50%);
                        color: rgba(255, 255, 255, 0.8);
                        font-size: 0.7rem;
                        font-weight: 700;
                    `;
                    label.textContent = i;
                    tick.appendChild(label);
                }
                ticksContainer.appendChild(tick);
            }
        }

        // Gestion du positionnement dynamique de la pop-up
        function positionPopup() {
            const populationItem = document.querySelector('.population-item');
            const popup = document.getElementById('populationPopup');
            
            if (!populationItem || !popup) return;
            
            const rect = populationItem.getBoundingClientRect();
            const popupRect = popup.getBoundingClientRect();
            
            // Position de base : au-dessus de l'élément, centré
            let top = rect.top - popupRect.height - 20;
            let left = rect.left + (rect.width / 2) - (popupRect.width / 2);
            
            // Ajustements si la pop-up sort de l'écran
            if (top < 10) {
                // Si pas assez de place en haut, afficher en bas
                top = rect.bottom + 10;
                popup.classList.add('bottom');
            } else {
                popup.classList.remove('bottom');
            }
            
            if (left < 10) {
                // Si trop à gauche
                left = 10;
            } else if (left + popupRect.width > window.innerWidth - 10) {
                // Si trop à droite
                left = window.innerWidth - popupRect.width - 10;
            }
            
            popup.style.top = `${top}px`;
            popup.style.left = `${left}px`;
        }

        // Event listeners pour le positionnement de la pop-up
        document.addEventListener('DOMContentLoaded', function() {
            generateTicks();
            updateIEHDisplay();
            // Initialiser la pop-up avec les données par défaut
            updatePopulationPopup(8100000000, '2024', false);
            
            // Ajouter les event listeners pour la pop-up
            const populationItem = document.querySelector('.population-item');
            if (populationItem) {
                populationItem.addEventListener('mouseenter', function() {
                    setTimeout(positionPopup, 10); // Petit délai pour que le CSS soit appliqué
                });
            }
            
            // Repositionner sur redimensionnement de fenêtre
            window.addEventListener('resize', positionPopup);
        });

        // Gestion de la modale des réserves de pétrole
        function showOilMap() {
            const modal = document.getElementById('oilMapModal');
            if (modal) {
                modal.classList.add('show');
                document.body.style.overflow = 'hidden'; // Empêche le scroll de la page
                console.log('🛢️ Ouverture de la carte des réserves de pétrole');
            }
        }

        function closeOilMap() {
            const modal = document.getElementById('oilMapModal');
            if (modal) {
                modal.classList.remove('show');
                document.body.style.overflow = 'auto'; // Restaure le scroll
                console.log('🛢️ Fermeture de la carte des réserves de pétrole');
            }
        }

        // Fermer la modale en cliquant sur le fond
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('oilMapModal');
            if (event.target === modal) {
                closeOilMap();
            }
        });

        // Fermer la modale avec la touche Escape
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeOilMap();
            }
        });

        // Calculer l'IEH initial et le mettre à jour régulièrement
        updateIEHDisplay();
        setInterval(updateMetrics, 30000); // Mise à jour toutes les 30 secondes
    </script>
</body>
</html>